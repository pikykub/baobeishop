<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAOBEI SHOP - PREMIUM STORE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    
    <style>
        :root { --main: #ff2d55; --bg: #fff5e6; --card-bg: #ffffff; --bank: #5d2e8e; --text: #2d3436; --line: #06C755; }
        
        * { box-sizing: border-box; }

        body { 
            font-family: 'Kanit', sans-serif; 
            margin: 0; 
            background: url('https://lh3.googleusercontent.com/d/1tgohnqPTuEtMOrhLQ_YMF7nqqQZETbsx') no-repeat center center fixed;
            background-size: cover;
            color: var(--text); 
            overflow-x: hidden; 
            min-height: 100vh;
        }

        /* 1. ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡πÄ‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà */
        .scrolling-news { background: #000; color: gold; padding: 8px 0; overflow: hidden; white-space: nowrap; position: relative; z-index: 2000; border-bottom: 2px solid gold; font-size: 14px; }
        .scrolling-news div { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        .announcement { background: rgba(34, 34, 34, 0.9); color: #fff; padding: 10px; text-align: center; font-size: 13px; font-weight: 300; position: relative; z-index: 10; }
        
        #snowCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }

        .navbar { background: rgba(255, 255, 255, 0.95); padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 15px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(5px); }
        .logo { font-size: 22px; font-weight: bold; color: var(--main); cursor: pointer; text-shadow: 1px 1px 2px rgba(0,0,0,0.05); }
        .nav-right { display: flex; gap: 10px; align-items: center; }
        
        .btn-contact { background: #eee; color: #555; padding: 8px 15px; border-radius: 50px; text-decoration: none; font-size: 14px; font-weight: 500; transition: 0.3s; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; }
        .btn-contact:hover { background: var(--line); color: white; transform: scale(1.1); }
        
        .balance-tag { background: var(--main); color: white; padding: 8px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(255, 45, 85, 0.3); }
        .balance-tag:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(255, 45, 85, 0.4); }
        
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ */
        .cart-tag { background: #333; color: white; padding: 8px 15px; border-radius: 50px; font-weight: bold; cursor: pointer; position: relative; display: flex; align-items: center; gap: 8px; }
        .cart-count { position: absolute; top: -5px; right: -5px; background: gold; color: black; font-size: 10px; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #fff; font-weight: bold; }
        .btn-add-cart { background: #333; color: white; border: none; width: 100%; padding: 10px; border-radius: 12px; font-weight: 500; cursor: pointer; margin-top: 5px; transition: 0.3s; font-size: 13px; }
        .btn-add-cart:hover { background: #000; }

        .btn-admin { background: #333; color: gold; padding: 8px 15px; border-radius: 50px; font-size: 14px; font-weight: bold; display: none; cursor: pointer; border: none; transition: 0.3s; }
        .btn-admin:hover { background: #000; color: #fff; }

        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; position: relative; z-index: 5; }
        .title-bar { display: flex; justify-content: space-between; align-items: center; border-left: 6px solid var(--main); padding-left: 15px; margin-bottom: 35px; background: rgba(255, 255, 255, 0.85); border-radius: 0 10px 10px 0; box-shadow: 2px 2px 10px rgba(0,0,0,0.05); padding-right: 15px; }

        .banner-container { width: 100%; margin-bottom: 30px; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.15); transition: 0.3s; }
        .banner-img { width: 100%; height: auto; display: block; object-fit: cover; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-box { background: rgba(26, 26, 26, 0.85); color: white; padding: 20px; border-radius: 15px; display: flex; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; text-align: center; backdrop-filter: blur(5px); }
        .stat-box:hover { border-color: var(--main); transform: translateY(-5px); }
        .stat-label { font-size: 13px; color: #aaa; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #fff; }

        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 25px; }
        .product-card { background: rgba(255,255,255,0.9); border-radius: 20px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: 0.4s; position: relative; border: 1px solid rgba(255,255,255,0.5); backdrop-filter: blur(10px); }
        .product-card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }
        .stock-tag { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.7); color: white; padding: 5px 12px; border-radius: 50px; font-size: 11px; font-weight: bold; z-index: 2; }
        .product-img { width: 100%; height: 200px; object-fit: contain; padding: 20px; transition: 0.3s; }
        .product-card:hover .product-img { transform: scale(1.05); }
        .product-info { padding: 20px; text-align: center; border-top: 1px solid #f1f1f1; background: #fff; }
        .product-name { font-weight: 500; margin-bottom: 10px; height: 45px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .product-price { color: var(--main); font-size: 22px; font-weight: 700; margin-bottom: 15px; }
        
        .btn-buy { background: var(--main); color: white; border: none; width: 100%; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-buy:hover:not(:disabled) { background: #e61b46; transform: scale(1.02); }
        .btn-buy:disabled { background: #ccc; cursor: not-allowed; }

        /* ‡∏£‡∏∞‡∏ö‡∏ö Progress Bar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å */
        .stock-progress-container { width: 100%; height: 6px; background: #eee; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .stock-progress-bar { height: 100%; transition: 0.5s; }
        .stock-status-text { font-size: 11px; color: #888; margin-bottom: 5px; display: block; }

        .hidden { display: none !important; }
        .topup-card { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 25px; text-align: center; max-width: 500px; margin: 0 auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        
        #loginPage, #registerPage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 3000; backdrop-filter: blur(8px); }
        .login-card { background: white; padding: 40px; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); width: 90%; max-width: 400px; text-align: center; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #eee; border-radius: 12px; font-family: 'Kanit'; outline: none; transition: 0.3s; }
        .login-input:focus { border-color: var(--main); }

        /* Filter */
        .filter-section { background: rgba(255,255,255,0.9); padding: 15px; border-radius: 15px; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .search-input { flex: 1; padding: 10px 15px; border-radius: 50px; border: 1px solid #ddd; outline: none; font-family: 'Kanit'; transition: 0.3s; }
        .search-input:focus { border-color: var(--main); box-shadow: 0 0 0 3px rgba(255, 45, 85, 0.1); }
        .category-btn { padding: 8px 15px; border-radius: 50px; border: 1px solid #ddd; background: #fff; cursor: pointer; transition: 0.3s; font-size: 13px; color: #666; }
        .category-btn:hover, .category-btn.active { background: var(--main); color: #fff; border-color: var(--main); }

        /* Auth Button */
        .btn-auth { background: var(--main); color: white; padding: 8px 20px; border-radius: 50px; text-decoration: none; font-size: 14px; font-weight: 500; cursor: pointer; border: none; transition: 0.3s; box-shadow: 0 4px 10px rgba(255, 45, 85, 0.3); }
        .btn-auth:hover { transform: translateY(-2px); background: #e61b46; }

        .user-profile-btn { display: flex; align-items: center; gap: 8px; cursor: pointer; background: #f8f9fa; padding: 5px 12px; border-radius: 50px; border: 1px solid #eee; transition: 0.3s; }
        .user-profile-btn:hover { background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .nav-avatar { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; border: 2px solid var(--main); }
        .nav-nickname { font-size: 14px; font-weight: 500; color: #333; }

        .btn-history { background: #333; color: #fff; border: none; padding: 8px 15px; border-radius: 10px; font-size: 13px; cursor: pointer; transition: 0.3s; }
        .btn-history:hover { background: #000; transform: scale(1.05); }
        .btn-daily { background: linear-gradient(45deg, #FFD700, #FFA500); color: #fff; border: none; padding: 8px 15px; border-radius: 10px; font-size: 13px; cursor: pointer; transition: 0.3s; font-weight: bold; box-shadow: 0 4px 10px rgba(255, 215, 0, 0.4); text-shadow: 0 1px 2px rgba(0,0,0,0.2); margin-left: 10px; }
        .btn-daily:hover { transform: scale(1.1) rotate(-2deg); }
        .btn-daily.claimed { background: #ddd; color: #999; box-shadow: none; cursor: not-allowed; transform: none; }

        .qr-section { background: #f8f9fa; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 2px dashed #ddd; }
        .slip-preview { width: 100px; height: 100px; object-fit: cover; border-radius: 10px; margin: 10px auto; border: 1px solid #ccc; display: none; }
        
        /* Chat Styles */
        .chat-widget { position: fixed; bottom: 100px; right: 30px; width: 320px; height: 450px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; z-index: 2500; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform: translateY(20px) scale(0.9); opacity: 0; pointer-events: none; }
        .chat-widget.active { transform: translateY(0) scale(1); opacity: 1; pointer-events: auto; }
        .chat-header { background: var(--main); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .chat-tabs { display: flex; border-bottom: 1px solid #eee; background: #f8f9fa; }
        .chat-tab { flex: 1; padding: 10px; text-align: center; font-size: 13px; cursor: pointer; transition: 0.3s; color: #999; border-bottom: 2px solid transparent; }
        .chat-tab.active { color: var(--main); border-bottom: 2px solid var(--main); background: #fff; font-weight: bold; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; font-size: 14px; display: flex; flex-direction: column; }
        .chat-row { display: flex; align-items: flex-end; margin-bottom: 15px; gap: 8px; width: 100%; }
        .chat-row.right { flex-direction: row-reverse; }
        
        /* Chat Avatar */
        .chat-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; flex-shrink: 0; transition: 0.2s; }
        .chat-avatar:hover { transform: scale(1.1); }
        
        .msg { padding: 8px 12px; border-radius: 15px; max-width: 75%; line-height: 1.4; word-break: break-all; position: relative; }
        .msg-admin { background: #e0e0e0; color: #333; border-bottom-left-radius: 2px; }
        .msg-user { background: var(--main); color: white; border-bottom-right-radius: 2px; }
        .msg-sender { font-size: 10px; font-weight: bold; margin-bottom: 2px; display: block; opacity: 0.7; cursor: pointer; }
        .msg-sender:hover { text-decoration: underline; color: #000; }
        
        .chat-actions { display: flex; gap: 10px; align-items: center; }
        .btn-delete-chat { background: none; border: none; color: white; cursor: pointer; font-size: 16px; opacity: 0.8; transition: 0.3s; display: none; }
        .btn-delete-chat:hover { opacity: 1; transform: scale(1.1); color: #ffeb3b; }

        .floating-chat { position: fixed; bottom: 30px; right: 30px; background: var(--line); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; z-index: 2000; box-shadow: 0 10px 25px rgba(6, 199, 85, 0.4); transition: 0.3s; }
        .floating-chat:hover { transform: rotate(15deg) scale(1.1); }

        /* Spotify Widget */
        .spotify-widget { position: fixed; bottom: 20px; left: 20px; z-index: 1900; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border-radius: 12px; overflow: hidden; transition: 0.3s; }
        .spotify-widget:hover { transform: translateY(-5px); }
        @media (max-width: 600px) { .spotify-widget { width: 280px; bottom: 90px; left: 10px; } }

        @media (max-width: 600px) { 
            .chat-widget { right: 10px; width: calc(100% - 20px); bottom: 90px; }
            .stats-grid { gap: 10px; }
            .stat-value { font-size: 18px; }
            .nav-nickname { display: none; }
            .filter-section { flex-direction: column; align-items: stretch; }
            .category-btn { text-align: center; }
        }
    </style>
</head>
<body>
    <div class="scrolling-news">
        <div>‚ú® BAOBEI SHOP ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö! ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÄ‡∏û‡∏µ‡∏¢‡∏ö! | üî• ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô: ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î BAOBEI10 ‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 10% | üéµ ‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏ö‡∏≤‡∏¢‡πÜ ‡∏Ç‡∏ì‡∏∞‡∏ä‡πâ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á ‚ú®</div>
    </div>

    <canvas id="snowCanvas"></canvas>

    <div class="spotify-widget">
        <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M?utm_source=generator&theme=0" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
    </div>

    <div id="registerPage" class="hidden">
        <div class="login-card">
            <h2 style="color: var(--main);">CREATE ACCOUNT</h2>
            <input type="text" id="regUsername" class="login-input" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
            <input type="password" id="regPassword" class="login-input" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button class="btn-buy" onclick="handleRegister()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            <p style="font-size: 14px; margin-top: 15px;">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? <a href="#" onclick="toggleAuth('login')" style="color: var(--main); text-decoration: none; font-weight: 500;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a></p>
        </div>
    </div>

    <div id="loginPage" class="hidden">
        <div class="login-card">
            <h2 style="color: var(--main);">BAOBEI LOGIN</h2>
            <input type="text" id="loginUsername" class="login-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
            <input type="password" id="loginPassword" class="login-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button class="btn-buy" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <p style="font-size: 14px; margin-top: 15px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="#" onclick="toggleAuth('register')" style="color: var(--main); text-decoration: none; font-weight: 500;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a></p>
            <p style="font-size: 11px; color: #aaa; margin-top: 10px;">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 15 ‡∏ô‡∏≤‡∏ó‡∏µ</p>
        </div>
    </div>

    <div id="shopContent">
        <div class="announcement">‚ú® ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà BAOBEI SHOP | ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏π‡πÅ‡∏• 24 ‡∏ä‡∏°. ‚ú®</div>
        <nav class="navbar">
            <div class="logo" onclick="showPage('home')">BAOBEI SHOP</div>
            <div class="nav-right">
                <div id="guestMenu">
                    <button class="btn-auth" onclick="toggleAuth('login')"><i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                </div>
                
                <div id="userMenu" class="hidden" style="display:flex; gap:10px; align-items:center;">
                    <div class="user-profile-btn" onclick="openEditProfile()">
                        <img id="navAvatarImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="nav-avatar">
                        <span id="navNickname" class="nav-nickname">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span>
                    </div>
                    <div class="cart-tag" onclick="showCart()">
                        <i class="fas fa-shopping-cart"></i> 
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                    <button id="adminBtn" class="btn-admin" onclick="openAdminPanel()">
                        <i class="fas fa-user-shield"></i>
                    </button>
                    <div class="balance-tag" onclick="showPage('topup')">
                        <i class="fas fa-wallet"></i> <span id="balanceDisplay">0</span> ‡∏ø
                    </div>
                    <a href="#" onclick="handleLogout()" class="btn-contact"><i class="fas fa-sign-out-alt"></i></a>
                </div>
            </div>
        </nav>

        <div class="container">
            <div id="homePage">
                <div class="banner-container">
                    <img src="https://lh3.googleusercontent.com/d/1ALVIB9eXw_BXz1By7UBemWyY_0Gp-YoF" alt="Banner" class="banner-img">
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="stat-value"><span id="statStock">0</span> <small style="font-size: 12px; font-weight: 300;">‡∏ä‡∏¥‡πâ‡∏ô</small></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
                        <div class="stat-value"><span id="statUsers">703</span> <small style="font-size: 12px; font-weight: 300;">‡∏Ñ‡∏ô</small></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∞‡∏™‡∏°</div>
                        <div class="stat-value"><span id="statSalesTotal">1089</span> <small style="font-size: 12px; font-weight: 300;">‡∏ö‡∏¥‡∏•</small></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</div>
                        <div class="stat-value"><span id="statTopupTotal">2,581</span> <small style="font-size: 12px; font-weight: 300;">‡∏ø</small></div>
                    </div>
                </div>
                
                <div class="title-bar">
                    <h2 style="display:flex; align-items:center;">
                        <i class="fas fa-shopping-bag" style="margin-right:10px;"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                        <button id="btnDaily" class="btn-daily" onclick="claimDailyReward()">üéÅ ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ü‡∏£‡∏µ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                    </h2>
                    <button class="btn-history" onclick="showOrderHistory()"><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</button>
                </div>

                <div class="filter-section">
                    <input type="text" id="searchInput" class="search-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." onkeyup="filterProducts()">
                    <div id="categoryFilters" style="display:flex; gap:5px; flex-wrap:wrap;">
                        <div class="category-btn active" onclick="setCategory('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="category-btn" onclick="setCategory('email')">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
                        <div class="category-btn" onclick="setCategory('id')">‡πÑ‡∏≠‡∏î‡∏µ‡πÄ‡∏Å‡∏°</div>
                        <div class="category-btn" onclick="setCategory('code')">‡πÇ‡∏Ñ‡πâ‡∏î/‡∏ö‡∏±‡∏ï‡∏£</div>
                    </div>
                </div>

                <div id="productList" class="product-grid"></div>
            </div>

            <div id="topupPage" class="hidden">
                <div class="topup-card">
                    <h3 style="margin-top:0"><i class="fas fa-university"></i> ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                    
                    <div class="qr-section">
                        <p style="font-weight: bold; color: var(--bank); margin: 5px 0;">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ô‡∏≤‡∏Ñ‡∏¥‡∏ô‡∏†‡∏±‡∏ó‡∏£ (KKP)</p>
                        <p style="font-size: 20px; letter-spacing: 1px; font-weight: bold; color: #000;">201-201-9014</p>
                        <div style="height: 1px; background: #eee; margin: 10px 0;"></div>
                        <p style="font-weight: bold; color: #f59e0b; margin: 5px 0;">TrueMoney Wallet</p>
                        <p style="font-size: 20px; letter-spacing: 1px; font-weight: bold; color: #000;">080-920-0932</p>
                        <p style="font-size: 14px; margin: 10px 0 0 0;">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏à‡∏¥‡∏ï‡∏£‡∏≤‡∏†‡∏£‡∏ì‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£</p>
                        <img src="https://lh3.googleusercontent.com/d/1ardGOoNH5cU-qLoTaZ7VHLs8kUCriNmX" alt="QR Code" style="margin-top: 15px; width: 180px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    </div>

                    <input type="number" id="topupAmount" class="login-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô">
                    
                    <div style="margin-top: 10px;">
                        <label for="slipInput" style="display: block; cursor: pointer; background: #f0f0f0; padding: 12px; border-radius: 12px; font-size: 14px; border: 1px solid #ddd;">
                            <i class="fas fa-file-invoice"></i> ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        </label>
                        <input type="file" id="slipInput" accept="image/*" class="hidden" onchange="previewSlip(this)">
                        <img id="slipPreviewImg" class="slip-preview">
                    </div>

                    <button class="btn-buy" onclick="submitTopup()" style="margin-top: 20px;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÇ‡∏≠‡∏ô</button>
                    <p onclick="showPage('home')" style="cursor:pointer; margin-top:20px; color:#999; font-size: 14px;"><i class="fas fa-chevron-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</p>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-widget" id="chatBox">
        <div class="chat-header">
            <span><i class="fas fa-comments"></i> <span id="chatTitle">Global Chat</span></span>
            <div class="chat-actions">
                <button id="btnDeleteChat" class="btn-delete-chat" onclick="deleteCurrentChat()" title="‡∏•‡∏ö‡πÅ‡∏ä‡∏ó‡∏ô‡∏µ‡πâ"><i class="fas fa-trash"></i></button>
                <i class="fas fa-times" style="cursor:pointer" onclick="toggleWebChat()"></i>
            </div>
        </div>
        <div class="chat-tabs">
            <div id="tabGlobal" class="chat-tab active" onclick="setChatMode('global')">‡πÅ‡∏ä‡∏ó‡∏£‡∏ß‡∏°</div>
            <div id="tabPrivate" class="chat-tab" onclick="setChatMode('private')">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß)</div>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div style="padding: 10px; border-top: 1px solid #eee; display: flex; gap: 5px; background: #fff;">
            <input type="text" id="chatInput" style="flex:1; border: 1px solid #ddd; padding: 8px 12px; border-radius: 20px; outline:none;" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
            <button onclick="sendChat()" style="background: var(--main); color:white; border:none; width: 35px; height: 35px; border-radius: 50%; cursor:pointer;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
    <div class="floating-chat" onclick="toggleWebChat()"><i class="fas fa-comment-dots"></i></div>

    <script>
        // --- CONFIG ---
        const ADMIN_NAME = "adminLukpeach";
        const ADMIN_AVATAR_URL = "https://drive.google.com/uc?export=view&id=12RhOdgaJigGJCiIBURsppbEyBPmBhBT7"; 

        const PRODUCTS = [
            { id: 1, name: "email(‡∏ô‡∏≠‡∏Å) ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó", price: 10, category: "email", image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 2, name: "email(‡∏ô‡∏≠‡∏Å) ‡πÇ‡∏ô‡πÄ‡πÄ‡∏û‡∏Ñ", price: 12, category: "email", image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 3, name: "emailThai ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó", price: 15, category: "email", image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 4, name: "emailThai ‡πÇ‡∏ô‡πÅ‡∏û‡∏Ñ", price: 18, category: "email", image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 5, name: "Netflix 4K (30‡∏ß‡∏±‡∏ô)", price: 120, category: "code", image: "https://cdn-icons-png.flaticon.com/512/5977/5977590.png" },
            { id: 6, name: "Valorant ID (‡∏™‡∏∏‡πà‡∏°)", price: 50, category: "id", image: "https://cdn-icons-png.flaticon.com/512/3408/3408506.png" }
        ];
        const COUPONS = { "BAOBEI10": 0.10, "FREE5": 5, "ADMIN": 0.50 };

        let state = {
            users: JSON.parse(localStorage.getItem('baobei_users')) || {},
            inventory: JSON.parse(localStorage.getItem('baobei_inv')) || { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [] },
            topupRequests: JSON.parse(localStorage.getItem('baobei_requests')) || [],
            usedSlips: JSON.parse(localStorage.getItem('baobei_used_slips')) || [],
            salesCount: parseInt(localStorage.getItem('baobei_sales')) || 1089,
            totalTopupSum: parseFloat(localStorage.getItem('baobei_total_topup')) || 0,
            currentUser: null, 
            isAdmin: false,
            isModerator: false, 
            activePrivateUser: null,
            globalMessages: JSON.parse(localStorage.getItem('baobei_global_chat')) || [],
            privateMessages: JSON.parse(localStorage.getItem('baobei_private_chat')) || {},
            chatMode: 'global',
            cart: [],
            moderators: JSON.parse(localStorage.getItem('baobei_mods')) || [],
            currentCategory: 'all',
            searchQuery: ''
        };

        function persist() { try { localStorage.setItem('baobei_users', JSON.stringify(state.users)); localStorage.setItem('baobei_inv', JSON.stringify(state.inventory)); localStorage.setItem('baobei_requests', JSON.stringify(state.topupRequests)); localStorage.setItem('baobei_used_slips', JSON.stringify(state.usedSlips)); localStorage.setItem('baobei_sales', state.salesCount); localStorage.setItem('baobei_total_topup', state.totalTopupSum); localStorage.setItem('baobei_global_chat', JSON.stringify(state.globalMessages)); localStorage.setItem('baobei_private_chat', JSON.stringify(state.privateMessages)); localStorage.setItem('baobei_mods', JSON.stringify(state.moderators)); } catch (e) { console.error(e); } }
        function copyToClipboard(text) { navigator.clipboard.writeText(text).then(() => { Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡πâ‡∏ß!', showConfirmButton: false, timer: 1500 }); }); }
        function setCategory(cat) { state.currentCategory = cat; document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active')); event.target.classList.add('active'); updateUI(); }
        function filterProducts() { state.searchQuery = document.getElementById('searchInput').value.toLowerCase(); updateUI(); }
        
        function requireLogin() {
            if (!state.currentUser) {
                Swal.fire({ title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ', icon: 'info', confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', confirmButtonColor: 'var(--main)' }).then((r) => { if(r.isConfirmed) toggleAuth('login'); });
                return false;
            }
            return true;
        }

        function claimDailyReward() {
            if(!requireLogin()) return;
            const user = state.users[state.currentUser];
            const now = Date.now();
            const lastClaim = user.lastDailyClaim || 0;
            if (now - lastClaim > 86400000) {
                const reward = Math.floor(Math.random() * 5) + 1; 
                user.balance += reward;
                user.lastDailyClaim = now;
                persist(); updateUI();
                Swal.fire('‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!', `‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ü‡∏£‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ${reward} ‡∏ø`, 'success');
            } else { Swal.fire('‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß', `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏£‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ`, 'info'); }
        }

        function updateUI() {
            document.getElementById('statSalesTotal').innerText = state.salesCount.toLocaleString();
            document.getElementById('statUsers').innerText = Object.keys(state.users).length;
            document.getElementById('statTopupTotal').innerText = Math.floor(state.totalTopupSum).toLocaleString();
            let totalStock = Object.values(state.inventory).reduce((a, b) => a + b.length, 0);
            document.getElementById('statStock').innerText = totalStock;
            
            // Toggle Navbar based on Auth state
            const guestMenu = document.getElementById('guestMenu');
            const userMenu = document.getElementById('userMenu');
            
            if (state.currentUser && state.users[state.currentUser]) {
                // Logged In
                guestMenu.classList.add('hidden');
                userMenu.classList.remove('hidden');
                
                const user = state.users[state.currentUser];
                document.getElementById('balanceDisplay').innerText = user.balance.toLocaleString();
                document.getElementById('navNickname').innerText = user.nickname || state.currentUser;
                
                if(state.isAdmin) document.getElementById('navAvatarImg').src = ADMIN_AVATAR_URL;
                else if(user.avatar) document.getElementById('navAvatarImg').src = user.avatar;
                
                if (state.isAdmin || state.moderators.includes(state.currentUser)) {
                    document.getElementById('adminBtn').style.display = "block";
                    state.isModerator = !state.isAdmin;
                } else {
                    document.getElementById('adminBtn').style.display = "none";
                }

                const btnDaily = document.getElementById('btnDaily');
                if (Date.now() - (user.lastDailyClaim || 0) < 86400000) { btnDaily.classList.add('claimed'); btnDaily.innerText = "‚úÖ ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"; } 
                else { btnDaily.classList.remove('claimed'); btnDaily.innerText = "üéÅ ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ü‡∏£‡∏µ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"; }

            } else {
                // Guest Mode
                guestMenu.classList.remove('hidden');
                userMenu.classList.add('hidden');
                document.getElementById('btnDaily').classList.remove('claimed');
                document.getElementById('btnDaily').innerText = "üéÅ ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ü‡∏£‡∏µ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô";
            }
            
            const filtered = PRODUCTS.filter(p => {
                const matchCat = state.currentCategory === 'all' || p.category === state.currentCategory;
                const matchSearch = p.name.toLowerCase().includes(state.searchQuery);
                return matchCat && matchSearch;
            });

            const list = document.getElementById('productList');
            if(filtered.length === 0) list.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:20px;color:#888;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>`;
            else list.innerHTML = filtered.map(p => {
                const stock = state.inventory[p.id]?.length || 0;
                const percent = Math.min((stock / 20) * 100, 100);
                const barColor = stock > 10 ? '#2ecc71' : (stock > 0 ? '#f39c12' : '#e74c3c');
                return `
                <div class="product-card">
                    <div class="stock-tag">${stock > 0 ? '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ' + stock : '‡∏´‡∏°‡∏î'}</div>
                    <img src="${p.image}" class="product-img" loading="lazy">
                    <div class="product-info">
                        <div class="product-name">${p.name}</div>
                        <span class="stock-status-text">${stock > 0 ? '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á' : '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß'}</span>
                        <div class="stock-progress-container"><div class="stock-progress-bar" style="width: ${percent}%; background: ${barColor};"></div></div>
                        <div class="product-price">${p.price} ‡∏ø</div>
                        <button class="btn-buy" onclick="buyProduct(${p.id})" ${stock === 0 && !state.isAdmin && !state.isModerator ? 'disabled' : ''}>${(state.isAdmin || state.isModerator) ? '‡∏ó‡∏î‡∏™‡∏≠‡∏ö' : (stock > 0 ? '‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ' : '‡∏´‡∏°‡∏î')}</button>
                        <button class="btn-add-cart" onclick="addToCart(${p.id})" ${stock === 0 ? 'style="display:none"' : ''}><i class="fas fa-cart-plus"></i></button>
                    </div>
                </div>`;
            }).join('');
            renderChat(); updateCartBadge();
        }

        function buyProduct(id) {
            if(!requireLogin()) return;
            const p = PRODUCTS.find(item => item.id === id);
            const user = state.users[state.currentUser];
            const hasPrivilege = (state.isAdmin || state.isModerator);
            
            if(state.inventory[id].length > 0) {
                Swal.fire({
                    title: `‡∏ã‡∏∑‡πâ‡∏≠ ${p.name}`,
                    html: `<p>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥: <b>${p.price} ‡∏ø</b></p><input id="couponInput" class="swal2-input" placeholder="‡πÉ‡∏™‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">`,
                    showCancelButton: true, confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠',
                    preConfirm: () => {
                        const code = document.getElementById('couponInput').value.trim().toUpperCase();
                        let finalPrice = p.price, discountMsg = "";
                        if (code && COUPONS[code]) {
                            const discount = COUPONS[code];
                            if (discount < 1) { finalPrice = p.price * (1 - discount); discountMsg = `(‡∏•‡∏î ${discount*100}%)`; } 
                            else { finalPrice = Math.max(0, p.price - discount); discountMsg = `(‡∏•‡∏î ${discount}‡∏ø)`; }
                        }
                        if (!hasPrivilege && user.balance < finalPrice) { Swal.showValidationMessage(`‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏•‡∏î‡∏Ñ‡∏∑‡∏≠ ${finalPrice} ‡∏ø`); return false; }
                        return { finalPrice, discountMsg };
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        const { finalPrice, discountMsg } = result.value;
                        const itemCode = state.inventory[id].pop();
                        if(!hasPrivilege) { user.balance -= finalPrice; if(!user.orders) user.orders = []; user.orders.unshift({ name: p.name + (discountMsg ? " "+discountMsg : ""), code: itemCode, date: new Date().toLocaleString() }); }
                        state.salesCount++; persist(); updateUI();
                        Swal.fire({ title: '‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', html: `<div style="background:#f9f9f9; padding:20px; border-radius:15px; border:2px dashed var(--main);"><p style="color:#666;">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</p><h3 style="color:var(--main); white-space: pre-wrap;">${itemCode}</h3><p style="font-size:12px; color:green;">‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á: ${finalPrice}‡∏ø ${discountMsg}</p><button onclick="copyToClipboard(\`${itemCode}\`)" class="btn-buy" style="width:auto; padding:5px 15px; font-size:12px;">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button></div>`, icon: 'success' });
                    }
                });
            } else { Swal.fire('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î', '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å', 'error'); }
        }

        // --- AUTH & OTHER FUNCTIONS ---
        function openEditProfile() { if(!requireLogin()) return; if(state.isAdmin) return Swal.fire('Admin', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'info'); const user = state.users[state.currentUser]; Swal.fire({ title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', html: `<div style="text-align:center;"><img id="ep" src="${user.avatar||'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" style="width:80px;height:80px;border-radius:50%;border:2px solid var(--main);"><br><input type="file" id="fi" hidden onchange="document.getElementById('ep').src=window.URL.createObjectURL(this.files[0]); const r=new FileReader(); r.readAsDataURL(this.files[0]); r.onload=e=>document.getElementById('ep').src=e.target.result;"><button onclick="document.getElementById('fi').click()" class="btn-history" style="margin:10px 0;">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ</button><br><input id="en" class="login-input" value="${user.nickname||''}" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô"></div>`, preConfirm: () => { return { n: document.getElementById('en').value, a: document.getElementById('ep').src } } }).then((r) => { if(r.isConfirmed){ user.nickname=r.value.n; user.avatar=r.value.a; persist(); updateUI(); } }); }
        
        function showPublicProfile(u) { if(typeof u!=='string') return; let usr = state.users[u], isAdm = (u==="Admin" || u===ADMIN_NAME); if(isAdm) usr={nickname:ADMIN_NAME, avatar:ADMIN_AVATAR_URL}; if(!usr) return; Swal.fire({ title: usr.nickname||u, imageUrl: usr.avatar, imageWidth: 100, imageHeight: 100, imageAlt: 'Avatar', text: isAdm?"Administrator":`User ID: ${u}` }); }
        
        function addToCart(id) { if(!requireLogin()) return; const p = PRODUCTS.find(i=>i.id===id); const stock = state.inventory[id]?.length||0; const item = state.cart.find(i=>i.id===id); if(stock > (item?item.qty:0)) { if(item) item.qty++; else state.cart.push({id:id, name:p.name, price:p.price, qty:1}); updateCartBadge(); Swal.fire({toast:true, position:'top-end', icon:'success', title:'Added', showConfirmButton:false, timer:800}); } else Swal.fire('‡∏´‡∏°‡∏î','‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠','warning'); }
        function updateCartBadge() { document.getElementById('cartCount').innerText = state.cart.reduce((a,b)=>a+b.qty,0); }
        function showCart() { if(!requireLogin()) return; if(state.cart.length===0) return Swal.fire('Empty','‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á','info'); let total=0, html='<div style="text-align:left;max-height:300px;overflow:auto;">'; state.cart.forEach((i,x)=>{ total+=i.price*i.qty; html+=`<div style="display:flex;justify-content:space-between;border-bottom:1px solid #eee;padding:5px;"><div>${i.name} x${i.qty}</div><div style="color:red;cursor:pointer" onclick="state.cart.splice(${x},1);Swal.close();showCart();">‚ùå</div></div>`; }); html+=`</div><h3 style="text-align:right">${total} ‡∏ø</h3>`; Swal.fire({title:'Cart', html:html, showCancelButton:true, confirmButtonText:'Pay'}).then(r=>{if(r.isConfirmed) processBulkBuy(total)}); }
        function processBulkBuy(total) { const user = state.users[state.currentUser]; if(!state.isAdmin && user.balance < total) return Swal.fire('Money','‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠','warning'); if(!state.isAdmin) user.balance -= total; let items=[]; state.cart.forEach(i=>{ for(let n=0;n<i.qty;n++){ const c=state.inventory[i.id].pop(); items.push({n:i.name,c:c}); if(!state.isAdmin){ if(!user.orders) user.orders=[]; user.orders.unshift({name:i.name,code:c,date:new Date().toLocaleString()}); } state.salesCount++; } }); state.cart=[]; persist(); updateUI(); Swal.fire('Success',items.map(x=>`${x.n}: ${x.c}`).join('<br>'),'success'); }
        function toggleAuth(t) { document.getElementById('loginPage').classList.toggle('hidden',t!=='login'); document.getElementById('registerPage').classList.toggle('hidden',t!=='register'); }
        function handleLogin() { const u=document.getElementById('loginUsername').value.trim(), p=document.getElementById('loginPassword').value.trim(); if(u.toLowerCase()==='admin' && p==='yongchai07'){ state.currentUser='Admin'; state.isAdmin=true; } else if(state.users[u] && state.users[u].password===p){ state.currentUser=u; state.isAdmin=false; } else return Swal.fire('Error','Login Failed','error'); document.getElementById('loginPage').classList.add('hidden'); updateUI(); }
        function handleRegister() { const u=document.getElementById('regUsername').value.trim(), p=document.getElementById('regPassword').value.trim(); if(!u||!p) return Swal.fire('Error','Empty fields','warning'); if(state.users[u]||u==='Admin') return Swal.fire('Error','Username taken','error'); state.users[u]={password:p, balance:0, orders:[], nickname:u, avatar:null}; persist(); Swal.fire('Success','Created','success').then(()=>toggleAuth('login')); }
        function handleLogout() { location.reload(); }
        function previewSlip(input) { if(input.files[0]){ const r=new FileReader(); r.onload=e=>document.getElementById('slipPreviewImg').src=e.target.result; r.readAsDataURL(input.files[0]); } }
        async function submitTopup() { if(!requireLogin()) return; const amt=parseFloat(document.getElementById('topupAmount').value), slip=document.getElementById('slipPreviewImg').src; if(!amt || slip.length<100) return Swal.fire('Error','Invalid input','warning'); const h=slip.substring(slip.length-20); if(state.usedSlips.includes(h)) return Swal.fire('Error','Slip used','error'); Swal.showLoading(); setTimeout(()=>{ state.users[state.currentUser].balance+=amt; state.totalTopupSum+=amt; state.usedSlips.push(h); state.topupRequests.push({user:state.currentUser,amount:amt,slip:slip,time:new Date().toLocaleString()}); persist(); updateUI(); Swal.fire('Success',`Added ${amt}‡∏ø`,'success').then(()=>showPage('home')); },1000); }
        function showOrderHistory() { if(!requireLogin()) return; const user = state.users[state.currentUser]; if(!user.orders||user.orders.length===0) return Swal.fire('Empty','No history','info'); Swal.fire({title:'History', html:`<div style="max-height:300px;overflow:auto;">${user.orders.map(o=>`<div style="border-bottom:1px solid #eee;padding:5px;text-align:left"><small>${o.date}</small><br><b>${o.name}</b><br><code style="white-space:pre-wrap;display:block;background:#f4f4f4;padding:5px;border-radius:5px;">${o.code}</code></div>`).join('')}</div>`}); }
        
        // --- 2. ADMIN PANEL FIX ---
        function openAdminPanel() { 
            let reqs = state.topupRequests.slice(-5).reverse().map(r=>`<div><small>${r.user} ${r.amount}‡∏ø</small><br><img src="${r.slip}" style="width:100px;"></div>`).join(''); 
            let chats = Object.keys(state.privateMessages).map(u=>`<button onclick="adminSelectUser('${u}')" style="margin:2px; padding:8px 12px; border:1px solid #ddd; background:#fff; border-radius:5px; cursor:pointer;">${u}</button>`).join(''); 
            
            // ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Moderator (‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏µ‡∏û!)
            let modSection = state.isAdmin ? `
                <hr>
                <h3>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô</h3>
                <div style="display:flex; gap:5px; margin-bottom:5px;">
                    <input type="text" id="modTarget" class="swal2-input" style="flex:1; margin:0;" placeholder="‡∏ä‡∏∑‡πà‡∏≠ User">
                    <button onclick="toggleModerator()" class="btn-buy" style="width:auto; padding:0 15px;">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö</button>
                </div>
                <small style="color:#666;">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${state.moderators.join(', ') || '-'}</small>
            ` : '';

            Swal.fire({ 
                title:'Admin', 
                html:`
                    <h3>Chats</h3>
                    <div style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center;">${chats || '<span style="color:#999">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>'}</div>
                    <hr>
                    <h3>Stock</h3>
                    <select id="ap" style="width:100%; margin-bottom:5px; padding:8px; border-radius:5px; border:1px solid #ccc;">${PRODUCTS.map(p=>`<option value="${p.id}">${p.name}</option>`).join('')}</select>
                    <textarea id="ac" style="width:100%; height:80px; padding:8px; border-radius:5px; border:1px solid #ccc;" placeholder="‡∏ß‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."></textarea>
                    <select id="am" style="margin-top:5px; padding:5px;"><option value="1">1 Line / Item</option><option value="2">2 Lines / Item</option></select>
                    ${modSection}
                    <hr>
                    <h3>Topups</h3>
                    <div style="max-height:150px; overflow-y:auto;">${reqs}</div>
                `, 
                preConfirm: () => { 
                    const pid=document.getElementById('ap').value, codes=document.getElementById('ac').value, mode=document.getElementById('am').value; 
                    if(codes.trim()){ 
                        const lines = codes.split('\n').filter(l=>l.trim()); 
                        let final = []; 
                        if(mode==="1") final=lines; 
                        else for(let i=0;i<lines.length;i+=2) final.push(lines[i]+(l[i+1]?("\n"+lines[i+1]):"")); 
                        state.inventory[pid].push(...final); persist(); updateUI(); return true; 
                    } 
                } 
            }); 
        }

        window.toggleModerator = () => {
            const target = document.getElementById('modTarget').value.trim();
            if(!state.users[target]) return Swal.fire('Error', 'User not found', 'error');
            if(target === 'Admin') return;
            const index = state.moderators.indexOf(target);
            if(index > -1) { state.moderators.splice(index, 1); Swal.fire('Removed', `${target} is no longer mod`, 'success'); }
            else { state.moderators.push(target); Swal.fire('Added', `${target} is now mod`, 'success'); }
            persist(); openAdminPanel();
        };

        window.adminSelectUser=u=>{state.activePrivateUser=u;state.chatMode='private';Swal.close();if(!document.getElementById('chatBox').classList.contains('active')) toggleWebChat();setChatMode('private');};
        function showPage(p) { if(p==='topup' && !requireLogin())return; document.getElementById('homePage').classList.toggle('hidden',p!=='home'); document.getElementById('topupPage').classList.toggle('hidden',p!=='topup'); }
        function toggleWebChat() { if(!requireLogin()) return; document.getElementById('chatBox').classList.toggle('active'); }
        function setChatMode(m) { state.chatMode=m; document.getElementById('tabGlobal').classList.toggle('active',m==='global'); document.getElementById('tabPrivate').classList.toggle('active',m==='private'); const isPrivateAdmin = (m === 'private' && (state.isAdmin || state.isModerator)); document.getElementById('btnDeleteChat').style.display = isPrivateAdmin ? 'block' : 'none'; document.getElementById('chatTitle').innerText = (m === 'global') ? "Global Chat" : ((state.isAdmin || state.isModerator) ? "‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö: "+state.activePrivateUser : "‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô"); renderChat(); }
        function deleteCurrentChat() { if(state.chatMode === 'private' && (state.isAdmin || state.isModerator) && state.activePrivateUser) { Swal.fire({ title: '‡∏•‡∏ö‡πÅ‡∏ä‡∏ó?', text: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?', icon: 'warning', showCancelButton: true }).then((r) => { if (r.isConfirmed) { delete state.privateMessages[state.activePrivateUser]; persist(); renderChat(); } }); } }
        function sendChat() { const t=document.getElementById('chatInput').value; if(!t)return; const senderName = state.isAdmin ? ADMIN_NAME : (state.users[state.currentUser].nickname || state.currentUser); const msg={sender:senderName, text:t, userId:state.currentUser, isAdmin:state.isAdmin}; if(state.chatMode==='global') state.globalMessages.push(msg); else { let u=state.isAdmin?state.activePrivateUser:state.currentUser; if(!state.privateMessages[u])state.privateMessages[u]=[]; state.privateMessages[u].push(msg); } persist(); renderChat(); document.getElementById('chatInput').value=''; }
        function renderChat() { const b=document.getElementById('chatMessages'); b.innerHTML=''; const msgs = state.chatMode==='global'?state.globalMessages:(state.privateMessages[state.isAdmin?state.activePrivateUser:state.currentUser]||[]); msgs.forEach(m=>{ const isMe = (m.userId === state.currentUser) || (state.isAdmin && (m.sender === 'Admin' || m.sender === ADMIN_NAME)); let ava = 'https://cdn-icons-png.flaticon.com/512/149/149071.png'; if(m.sender==='Admin' || m.sender===ADMIN_NAME) ava=ADMIN_AVATAR_URL; else if(state.users[m.userId]?.avatar) ava=state.users[m.userId].avatar; b.innerHTML+=`<div class="chat-row ${isMe?'right':''}"><img src="${ava}" class="chat-avatar" onclick="showPublicProfile('${m.userId}')"><div class="msg ${isMe?'msg-user':'msg-admin'}"><span class="msg-sender">${m.isAdmin?'üëë ':''}${m.sender}</span>${m.text}</div></div>`; }); b.scrollTop=b.scrollHeight; }
        const canvas=document.getElementById('snowCanvas'), ctx=canvas.getContext('2d'); let w,h,f=[]; function initS(){w=window.innerWidth;h=window.innerHeight;canvas.width=w;canvas.height=h;f=Array.from({length:80},()=>({x:Math.random()*w,y:Math.random()*h,r:Math.random()*3+1,d:Math.random()*1+0.5}));} function drawS(){ctx.clearRect(0,0,w,h);ctx.fillStyle="rgba(255,255,255,0.6)";ctx.beginPath();f.forEach(p=>{ctx.moveTo(p.x,p.y);ctx.arc(p.x,p.y,p.r,0,Math.PI*2);});ctx.fill();f.forEach(p=>{p.y+=p.d;if(p.y>h)p.y=-10;});requestAnimationFrame(drawS);} window.addEventListener('resize',initS);initS();drawS();updateUI();
    </script>
</body>
</html>
