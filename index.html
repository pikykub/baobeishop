<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAOBEI SHOP - PREMIUM STORE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    
    <style>
        :root { --main: #ff2d55; --bg: #fff5e6; --card-bg: #ffffff; --bank: #5d2e8e; --text: #2d3436; --line: #06C755; }
        * { box-sizing: border-box; }
        body { font-family: 'Kanit', sans-serif; margin: 0; background: url('https://lh3.googleusercontent.com/d/1tgohnqPTuEtMOrhLQ_YMF7nqqQZETbsx') no-repeat center center fixed; background-size: cover; color: var(--text); overflow-x: hidden; min-height: 100vh; }

        /* 1. ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® */
        .scrolling-news { background: #000; color: gold; padding: 8px 0; overflow: hidden; white-space: nowrap; position: relative; z-index: 2000; border-bottom: 2px solid gold; font-size: 14px; }
        .scrolling-news div { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        .announcement { background: rgba(34, 34, 34, 0.9); color: #fff; padding: 10px; text-align: center; font-size: 13px; font-weight: 300; position: relative; z-index: 10; }
        #snowCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }

        /* Navbar */
        .navbar { background: rgba(255, 255, 255, 0.95); padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 15px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(5px); }
        .logo { font-size: 22px; font-weight: bold; color: var(--main); cursor: pointer; }
        .nav-right { display: flex; gap: 10px; align-items: center; }
        .balance-tag { background: var(--main); color: white; padding: 8px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; }
        
        /* Profile & Cart */
        .user-profile-btn { display: flex; align-items: center; gap: 8px; cursor: pointer; background: #f8f9fa; padding: 5px 12px; border-radius: 50px; border: 1px solid #eee; }
        .nav-avatar { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; border: 2px solid var(--main); }
        .cart-tag { background: #333; color: white; padding: 8px 15px; border-radius: 50px; position: relative; cursor: pointer; }
        .cart-count { position: absolute; top: -5px; right: -5px; background: gold; color: black; font-size: 10px; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #fff; }

        /* Main Content */
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; position: relative; z-index: 5; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 25px; }
        .product-card { background: rgba(255,255,255,0.9); border-radius: 20px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; padding-bottom: 15px; }
        .product-img { width: 100%; height: 200px; object-fit: contain; padding: 20px; }
        
        /* Auth Pages */
        #loginPage, #registerPage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 3000; backdrop-filter: blur(8px); }
        .login-card { background: white; padding: 40px; border-radius: 25px; width: 90%; max-width: 400px; text-align: center; }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #eee; border-radius: 12px; font-family: 'Kanit'; }

        /* --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå --- */
        .chat-widget { position: fixed; bottom: 100px; right: 30px; width: 320px; height: 450px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; z-index: 2500; transition: 0.4s; transform: translateY(20px) scale(0.9); opacity: 0; pointer-events: none; }
        .chat-widget.active { transform: translateY(0) scale(1); opacity: 1; pointer-events: auto; }
        .chat-header { background: var(--main); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; display: flex; flex-direction: column; gap: 12px; }
        
        .msg-wrapper { display: flex; align-items: flex-end; gap: 8px; max-width: 85%; }
        .msg-wrapper.me { align-self: flex-end; flex-direction: row-reverse; }
        .msg-wrapper.other { align-self: flex-start; }

        .chat-pfp { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 1px solid #ddd; background: #eee; flex-shrink: 0; cursor: pointer; }
        .msg { padding: 8px 12px; border-radius: 15px; font-size: 14px; line-height: 1.4; word-break: break-all; position: relative; }
        .msg-user { background: var(--main); color: white; border-bottom-right-radius: 2px; }
        .msg-admin { background: #e0e0e0; color: #333; border-bottom-left-radius: 2px; }
        .msg-sender-name { font-size: 10px; font-weight: bold; margin-bottom: 2px; display: block; opacity: 0.8; }
        
        .floating-chat { position: fixed; bottom: 30px; right: 30px; background: var(--line); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; z-index: 2000; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="scrolling-news"><div>‚ú® BAOBEI SHOP ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö! | üî• ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏ç‡πà! ‚ú®</div></div>
    <canvas id="snowCanvas"></canvas>

    <div id="registerPage" class="hidden">
        <div class="login-card">
            <h2 style="color: var(--main);">CREATE ACCOUNT</h2>
            <input type="text" id="regUsername" class="login-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
            <input type="password" id="regPassword" class="login-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button class="login-input" style="background: var(--main); color:white; border:none; cursor:pointer;" onclick="handleRegister()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            <p onclick="toggleAuth('login')" style="cursor:pointer; font-size:14px; margin-top:10px;">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
        </div>
    </div>

    <div id="loginPage">
        <div class="login-card">
            <h2 style="color: var(--main);">BAOBEI LOGIN</h2>
            <input type="text" id="loginUsername" class="login-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
            <input type="password" id="loginPassword" class="login-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button class="login-input" style="background: var(--main); color:white; border:none; cursor:pointer;" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <p onclick="toggleAuth('register')" style="cursor:pointer; font-size:14px; margin-top:10px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
        </div>
    </div>

    <div id="shopContent" class="hidden">
        <nav class="navbar">
            <div class="logo" onclick="showPage('home')">BAOBEI SHOP</div>
            <div class="nav-right">
                <div class="user-profile-btn" onclick="openEditProfile()">
                    <img id="navAvatarImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="nav-avatar">
                    <span id="navNickname" class="nav-nickname">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span>
                </div>
                <div class="balance-tag" onclick="showPage('topup')">
                    <i class="fas fa-wallet"></i> <span id="balanceDisplay">0</span> ‡∏ø
                </div>
                <a href="#" onclick="handleLogout()" style="color:#555;"><i class="fas fa-sign-out-alt"></i></a>
            </div>
        </nav>

        <div class="container">
            <div id="homePage">
                <div id="productList" class="product-grid"></div>
            </div>
            <div id="topupPage" class="hidden">
                <div style="background:white; padding:30px; border-radius:20px; text-align:center; max-width:400px; margin:auto;">
                    <h3>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</h3>
                    <p>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ KKP: 201-201-9014</p>
                    <button class="login-input" onclick="showPage('home')">‡∏Å‡∏•‡∏±‡∏ö</button>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-widget" id="chatBox">
        <div class="chat-header">
            <span><i class="fas fa-comments"></i> <span id="chatTitle">Global Chat</span></span>
            <i class="fas fa-times" style="cursor:pointer" onclick="toggleWebChat()"></i>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div style="padding: 10px; display: flex; gap: 5px;">
            <input type="text" id="chatInput" style="flex:1; border: 1px solid #ddd; padding: 8px; border-radius: 20px;" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
            <button onclick="sendChat()" style="background: var(--main); color:white; border:none; width: 35px; height: 35px; border-radius: 50%;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
    <div class="floating-chat" onclick="toggleWebChat()"><i class="fas fa-comment-dots"></i></div>

    <script>
        const PRODUCTS = [
            { id: 1, name: "email(‡∏ô‡∏≠‡∏Å) ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó", price: 10, image: "https://cdn-icons-png.flaticon.com/512/281/281769.png" },
            { id: 2, name: "email(‡∏ô‡∏≠‡∏Å) ‡πÇ‡∏ô‡πÄ‡πÄ‡∏û‡∏Ñ", price: 12, image: "https://cdn-icons-png.flaticon.com/512/281/281769.png" }
        ];

        let state = {
            users: JSON.parse(localStorage.getItem('baobei_users')) || {},
            inventory: { 1: ["CODE1", "CODE2"], 2: ["CODE3"] },
            globalMessages: JSON.parse(localStorage.getItem('baobei_global_chat')) || [],
            currentUser: null,
            isAdmin: false
        };

        function persist() {
            localStorage.setItem('baobei_users', JSON.stringify(state.users));
            localStorage.setItem('baobei_global_chat', JSON.stringify(state.globalMessages));
        }

        function updateUI() {
            if (state.currentUser && state.users[state.currentUser]) {
                const user = state.users[state.currentUser];
                document.getElementById('balanceDisplay').innerText = user.balance;
                document.getElementById('navNickname').innerText = user.nickname || state.currentUser;
                if(user.avatar) document.getElementById('navAvatarImg').src = user.avatar;
            }
            
            const list = document.getElementById('productList');
            list.innerHTML = PRODUCTS.map(p => `
                <div class="product-card">
                    <img src="${p.image}" class="product-img">
                    <h4>${p.name}</h4>
                    <p style="color:var(--main)">${p.price} ‡∏ø</p>
                    <button onclick="buyProduct(${p.id})" style="padding:8px 20px; border-radius:10px; border:none; background:var(--main); color:white; cursor:pointer;">‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢</button>
                </div>
            `).join('');
            renderChat();
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ---
        function renderChat() {
            const chatBox = document.getElementById('chatMessages');
            chatBox.innerHTML = "";
            
            state.globalMessages.forEach(m => {
                const isMe = m.userId === state.currentUser;
                
                // ‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                let senderAvatar = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
                if (m.userId === "Admin") {
                    senderAvatar = "https://cdn-icons-png.flaticon.com/512/2206/2206368.png";
                } else if (state.users[m.userId] && state.users[m.userId].avatar) {
                    senderAvatar = state.users[m.userId].avatar;
                }

                const wrapper = document.createElement('div');
                wrapper.className = `msg-wrapper ${isMe ? 'me' : 'other'}`;
                
                wrapper.innerHTML = `
                    <img src="${senderAvatar}" class="chat-pfp" onclick="showPublicProfile('${m.userId}')">
                    <div class="msg ${isMe ? 'msg-user' : 'msg-admin'}">
                        <span class="msg-sender-name">${m.isAdmin ? 'üëë ' : ''}${m.sender}</span>
                        ${m.text}
                    </div>
                `;
                chatBox.appendChild(wrapper);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function sendChat() {
            const inp = document.getElementById('chatInput');
            if(!inp.value.trim() || !state.currentUser) return;
            
            const senderName = state.isAdmin ? "Admin" : (state.users[state.currentUser].nickname || state.currentUser);
            const msg = { 
                sender: senderName,
                userId: state.currentUser,
                text: inp.value, 
                isAdmin: state.isAdmin,
                time: Date.now() 
            };
            
            state.globalMessages.push(msg);
            persist();
            renderChat();
            inp.value = "";
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ
        function handleLogin() {
            const u = document.getElementById('loginUsername').value.trim();
            const p = document.getElementById('loginPassword').value.trim();
            if(u === 'admin' && p === '1234') { state.currentUser = 'Admin'; state.isAdmin = true; }
            else if(state.users[u] && state.users[u].password === p) { state.currentUser = u; state.isAdmin = false; }
            else { return alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î'); }
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('shopContent').classList.remove('hidden');
            updateUI();
        }

        function handleRegister() {
            const u = document.getElementById('regUsername').value.trim();
            const p = document.getElementById('regPassword').value.trim();
            if(u && p) {
                state.users[u] = { password: p, balance: 0, nickname: u, avatar: null };
                persist(); alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß'); toggleAuth('login');
            }
        }

        function toggleAuth(t) {
            document.getElementById('loginPage').classList.toggle('hidden', t !== 'login');
            document.getElementById('registerPage').classList.toggle('hidden', t !== 'register');
        }

        function toggleWebChat() { document.getElementById('chatBox').classList.toggle('active'); }
        function showPage(p) { 
            document.getElementById('homePage').classList.toggle('hidden', p !== 'home');
            document.getElementById('topupPage').classList.toggle('hidden', p !== 'topup');
        }
        function handleLogout() { location.reload(); }

        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        function openEditProfile() {
            Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå',
                html: `<input type="text" id="swalNickname" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
                       <input type="file" id="swalFile" class="swal2-file" accept="image/*">`,
                preConfirm: () => {
                    const nickname = document.getElementById('swalNickname').value;
                    const file = document.getElementById('swalFile').files[0];
                    return { nickname, file };
                }
            }).then(res => {
                if(res.value) {
                    if(res.value.nickname) state.users[state.currentUser].nickname = res.value.nickname;
                    if(res.value.file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            state.users[state.currentUser].avatar = e.target.result;
                            persist(); updateUI();
                        };
                        reader.readAsDataURL(res.value.file);
                    } else { persist(); updateUI(); }
                }
            });
        }

        function showPublicProfile(uid) {
            const u = uid === 'Admin' ? {nickname:'Admin'} : state.users[uid];
            if(u) Swal.fire(u.nickname || uid, '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á BAOBEI SHOP', 'info');
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡∏¥‡∏°‡∏∞
        const canvas = document.getElementById('snowCanvas');
        const ctx = canvas.getContext('2d');
        function initSnow() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = initSnow; initSnow();
        updateUI();
    </script>
</body>
</html>
