<div id="homePage">
    <div class="title-bar" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á</h2>
        <input type="text" id="searchInput" onkeyup="searchProduct()" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." style="padding: 10px 20px; border-radius: 50px; border: 1px solid #ddd; outline: none; width: 250px;">
    </div>
    <div id="productList" class="product-grid"></div>
</div>

<script>
    // 1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏à‡∏£‡∏¥‡∏á)
    const productData = {
        1: ["out1:pass111", "out2:pass222", "out3:pass333"], // ‡πÄ‡∏°‡∏•‡∏•‡πå‡∏ô‡∏≠‡∏Å ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó
        2: ["free1:pass444", "free2:pass555"],               // ‡πÄ‡∏°‡∏•‡∏•‡πå‡∏ô‡∏≠‡∏Å ‡πÇ‡∏ô‡πÅ‡∏û‡∏Ñ
        3: ["thai1:pass666"],                                 // ‡πÄ‡∏°‡∏•‡∏•‡πå‡πÑ‡∏ó‡∏¢ ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó
        4: []                                                // ‡πÄ‡∏°‡∏•‡∏•‡πå‡πÑ‡∏ó‡∏¢ ‡πÇ‡∏ô‡πÅ‡∏û‡∏Ñ (‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏î)
    };

    const products = [
        { id: 1, name: "email(‡∏ô‡∏≠‡∏Å) ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó", price: 10, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
        { id: 2, name: "email(‡∏ô‡∏≠‡∏Å) ‡πÇ‡∏ô‡πÄ‡πÄ‡∏û‡∏Ñ", price: 12, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
        { id: 3, name: "emailThai ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó", price: 15, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
        { id: 4, name: "emailThai ‡πÇ‡∏ô‡πÅ‡∏û‡∏Ñ", price: 18, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" }
    ];

    let wallet = parseFloat(localStorage.getItem('walletBalance') || 0);

    // 2. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏à‡∏£‡∏¥‡∏á
    function updateUI(filter = "") {
        document.getElementById('balanceDisplay').innerText = wallet.toLocaleString();
        const list = document.getElementById('productList');
        
        const filtered = products.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
        
        list.innerHTML = filtered.map(p => {
            const currentStock = productData[p.id].length;
            return `
                <div class="product-card">
                    <div class="stock-tag">${currentStock > 0 ? '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ' + currentStock : '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î'}</div>
                    <img src="${p.image}" class="product-img">
                    <div class="product-info">
                        <div class="product-name">${p.name}</div>
                        <div class="product-price">${p.price} ‡∏ø</div>
                        <button class="btn-buy" onclick="buyProduct(${p.id})" ${currentStock === 0 ? 'style="background:#ccc" disabled' : ''}>
                            ${currentStock > 0 ? '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' : '‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏î'}
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    // 3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    function searchProduct() {
        const term = document.getElementById('searchInput').value;
        updateUI(term);
    }

    // 4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏à‡∏£‡∏¥‡∏á
    function buyProduct(id) {
        const p = products.find(i => i.id === id);
        const stock = productData[id];

        if (wallet < p.price) {
            Swal.fire('‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠', 'warning').then(() => showPage('topup'));
            return;
        }

        if (stock.length === 0) {
            Swal.fire('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ', 'error');
            updateUI();
            return;
        }

        Swal.fire({
            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠?',
            text: `‡∏ã‡∏∑‡πâ‡∏≠ ${p.name} ‡∏£‡∏≤‡∏Ñ‡∏≤ ${p.price} ‡∏ø`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
            confirmButtonColor: '#ff2d55'
        }).then((result) => {
            if (result.isConfirmed) {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ (First-in First-out)
                const itemReceived = stock.shift(); 
                wallet -= p.price;
                localStorage.setItem('walletBalance', wallet);
                
                updateUI();

                Swal.fire({
                    title: '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    html: `<div style="background:#f8f9fa; padding:15px; border-radius:10px; margin-top:10px;">
                            <p style="margin-bottom:5px; font-size:14px; color:#666;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</p>
                            <code style="font-size:18px; color:#ff2d55; font-weight:bold;">${itemReceived}</code>
                           </div>`,
                    icon: 'success',
                    confirmButtonText: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
                }).then(() => {
                    navigator.clipboard.writeText(itemReceived);
                });
            }
        });
    }

    updateUI();
</script>
