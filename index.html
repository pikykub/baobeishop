<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAOBEI SHOP - PREMIUM STORE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { --main: #ff2d55; --bg: #fff5e6; --card-bg: #ffffff; --bank: #5d2e8e; --text: #2d3436; --line: #06C755; --danger: #dc3545; --bot: #007bff; --coupon: #ff9f43; --fb: #1877F2; }
        * { box-sizing: border-box; }
        body { font-family: 'Kanit', sans-serif; margin: 0; background-color: var(--bg); background-repeat: no-repeat; background-position: center center; background-attachment: fixed; background-size: cover; color: var(--text); overflow-x: hidden; min-height: 100vh; transition: background-image 0.5s ease-in-out; }
        .scrolling-news { background: #000; color: gold; padding: 8px 0; overflow: hidden; white-space: nowrap; position: relative; z-index: 2000; border-bottom: 2px solid gold; font-size: 14px; }
        .scrolling-news div { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        .announcement { background: rgba(34, 34, 34, 0.9); color: #fff; padding: 10px; text-align: center; font-size: 13px; font-weight: 300; position: relative; z-index: 10; }
        #snowCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .navbar { background: rgba(255, 255, 255, 0.95); padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 15px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(5px); }
        .logo { font-size: 22px; font-weight: bold; color: var(--main); cursor: pointer; text-shadow: 1px 1px 2px rgba(0,0,0,0.05); }
        .nav-right { display: flex; gap: 10px; align-items: center; }
        .btn-auth { background: #eee; color: #555; padding: 8px 15px; border-radius: 50px; text-decoration: none; font-size: 14px; font-weight: 500; transition: 0.3s; display: flex; align-items: center; justify-content: center; height: 40px; cursor: pointer; border: none; }
        .btn-auth:hover { background: var(--line); color: white; transform: scale(1.05); }
        .balance-tag { background: var(--main); color: white; padding: 8px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(255, 45, 85, 0.3); }
        .balance-tag:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(255, 45, 85, 0.4); }
        .cart-tag { background: #333; color: white; padding: 8px 15px; border-radius: 50px; font-weight: bold; cursor: pointer; position: relative; display: flex; align-items: center; gap: 8px; }
        .cart-count { position: absolute; top: -5px; right: -5px; background: gold; color: black; font-size: 10px; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #fff; font-weight: bold; }
        .btn-add-cart { background: #333; color: white; border: none; width: 100%; padding: 10px; border-radius: 12px; font-weight: 500; cursor: pointer; margin-top: 5px; transition: 0.3s; font-size: 13px; }
        .btn-add-cart:hover { background: #000; }
        .btn-admin { background: #333; color: gold; padding: 8px 15px; border-radius: 50px; font-size: 14px; font-weight: bold; display: none; cursor: pointer; border: none; transition: 0.3s; }
        .btn-admin:hover { background: #000; color: #fff; }
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; position: relative; z-index: 5; }
        .title-bar { display: flex; justify-content: space-between; align-items: center; border-left: 6px solid var(--main); padding-left: 15px; margin-bottom: 35px; background: rgba(255, 255, 255, 0.85); border-radius: 0 10px 10px 0; box-shadow: 2px 2px 10px rgba(0,0,0,0.05); padding-right: 15px; }
        .banner-container { width: 100%; margin-bottom: 30px; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.15); transition: 0.3s; }
        .banner-img { width: 100%; height: auto; display: block; object-fit: cover; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-box { background: rgba(26, 26, 26, 0.85); color: white; padding: 20px; border-radius: 15px; display: flex; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; text-align: center; backdrop-filter: blur(5px); }
        .stat-box:hover { border-color: var(--main); transform: translateY(-5px); }
        .stat-label { font-size: 13px; color: #aaa; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #fff; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 25px; }
        .product-card { background: rgba(255,255,255,0.9); border-radius: 20px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: 0.4s; position: relative; border: 1px solid rgba(255,255,255,0.5); backdrop-filter: blur(10px); }
        .product-card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }
        .stock-tag { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.7); color: white; padding: 5px 12px; border-radius: 50px; font-size: 11px; font-weight: bold; z-index: 2; }
        .product-img { width: 100%; height: 200px; object-fit: contain; padding: 20px; transition: 0.3s; }
        .product-card:hover .product-img { transform: scale(1.05); }
        .product-info { padding: 20px; text-align: center; border-top: 1px solid #f1f1f1; background: #fff; }
        .product-name { font-weight: 500; margin-bottom: 10px; height: 45px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .product-price { color: var(--main); font-size: 22px; font-weight: 700; margin-bottom: 15px; }
        .btn-buy { background: var(--main); color: white; border: none; width: 100%; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-buy:hover:not(:disabled) { background: #e61b46; transform: scale(1.02); }
        .btn-buy:disabled { background: #ccc; cursor: not-allowed; }
        .hidden { display: none !important; }
        .topup-card { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 25px; text-align: center; max-width: 500px; margin: 0 auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        #loginPage, #registerPage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(8px); }
        .login-card { background: white; padding: 40px; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); width: 90%; max-width: 400px; text-align: center; position: relative; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #eee; border-radius: 12px; font-family: 'Kanit'; outline: none; transition: 0.3s; }
        .login-input:focus { border-color: var(--main); }
        .btn-close-modal { position: absolute; top: 15px; right: 15px; cursor: pointer; font-size: 20px; color: #999; }
        .btn-close-modal:hover { color: #333; }
        .chat-widget { position: fixed; bottom: 100px; right: 30px; width: 320px; height: 450px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; z-index: 2500; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform: translateY(20px) scale(0.9); opacity: 0; pointer-events: none; }
        .chat-widget.active { transform: translateY(0) scale(1); opacity: 1; pointer-events: auto; }
        .chat-header { background: var(--main); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .chat-tabs { display: flex; border-bottom: 1px solid #eee; background: #f8f9fa; }
        .chat-tab { flex: 1; padding: 10px; text-align: center; font-size: 13px; cursor: pointer; transition: 0.3s; color: #999; border-bottom: 2px solid transparent; }
        .chat-tab.active { color: var(--main); border-bottom: 2px solid var(--main); background: #fff; font-weight: bold; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; font-size: 14px; display: flex; flex-direction: column; }
        .chat-row { display: flex; align-items: flex-end; margin-bottom: 15px; gap: 8px; width: 100%; }
        .chat-row.right { flex-direction: row-reverse; }
        .chat-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; flex-shrink: 0; transition: 0.2s; }
        .chat-avatar:hover { transform: scale(1.1); }
        .msg { padding: 8px 12px; border-radius: 15px; max-width: 75%; line-height: 1.4; word-break: break-all; position: relative; }
        .msg-admin { background: #e0e0e0; color: #333; border-bottom-left-radius: 2px; }
        .msg-user { background: var(--main); color: white; border-bottom-right-radius: 2px; }
        .msg-bot { background: linear-gradient(135deg, #007bff, #00c6ff); color: white; border-radius: 15px; border-bottom-left-radius: 2px; box-shadow: 0 2px 10px rgba(0,123,255,0.2); }
        .chat-img { max-width: 100%; border-radius: 10px; margin-top: 5px; cursor: pointer; transition: 0.2s; border: 1px solid rgba(0,0,0,0.1); }
        .chat-img:hover { opacity: 0.9; }
        .msg-sender { font-size: 10px; font-weight: bold; margin-bottom: 2px; display: block; opacity: 0.7; cursor: pointer; }
        .floating-chat { position: fixed; bottom: 30px; right: 30px; background: var(--line); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; z-index: 2000; box-shadow: 0 10px 25px rgba(6, 199, 85, 0.4); transition: 0.3s; }
        .floating-chat:hover { transform: rotate(15deg) scale(1.1); }
        .qr-section { background: #f8f9fa; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 2px dashed #ddd; }
        .slip-preview { width: 100px; height: 100px; object-fit: cover; border-radius: 10px; margin: 10px auto; border: 1px solid #ccc; display: none; }
        .btn-history { background: #333; color: #fff; border: none; padding: 8px 15px; border-radius: 10px; font-size: 13px; cursor: pointer; transition: 0.3s; }
        .btn-history:hover { background: #000; transform: scale(1.05); }
        .user-profile-btn { display: flex; align-items: center; gap: 8px; cursor: pointer; background: #f8f9fa; padding: 5px 12px; border-radius: 50px; border: 1px solid #eee; transition: 0.3s; }
        .user-profile-btn:hover { background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .nav-avatar { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; border: 2px solid var(--main); }
        .nav-nickname { font-size: 14px; font-weight: 500; color: #333; display: flex; flex-direction: column; line-height: 1.1; text-align: left; }
        .nav-id-badge { font-size: 10px; color: #888; letter-spacing: 0.5px; }

        .contact-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
        .social-btn { display: flex; align-items: center; gap: 10px; padding: 12px 25px; border-radius: 50px; color: white; text-decoration: none; font-weight: bold; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: 2px solid white; }
        .social-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
        .social-fb { background: var(--fb); } 
        .social-line { background: var(--line); } 

        #global-loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(5px); z-index: 10000; display: none; flex-direction: column; justify-content: center; align-items: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #ffeeba; border-top: 5px solid var(--main); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loader-text { margin-top: 15px; font-weight: bold; color: var(--main); letter-spacing: 1px; font-size: 16px; }

        @media (max-width: 600px) { 
            .chat-widget { right: 10px; width: calc(100% - 20px); bottom: 90px; }
            .stats-grid { gap: 10px; }
            .stat-value { font-size: 18px; }
            .nav-nickname { display: none; }
        }
    </style>
</head>
<body>
    <div id="global-loader">
        <div class="spinner"></div>
        <div class="loader-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</div>
    </div>

    <div class="scrolling-news">
        <div>‚ú® BAOBEI SHOP ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö! ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÄ‡∏û‡∏µ‡∏¢‡∏ö! | üî• ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏ç‡πà! | ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏°‡∏¥‡∏à‡∏â‡∏≤‡∏ä‡∏µ‡∏û ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ä‡∏∑‡πà‡∏≠ ‡∏à‡∏¥‡∏ï‡∏£‡∏≤‡∏†‡∏£‡∏ì‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£ ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô! ‚ú®</div>
    </div>

    <canvas id="snowCanvas"></canvas>

    <div id="registerPage" class="hidden">
        <div class="login-card">
            <i class="fas fa-times btn-close-modal" onclick="closeAuth()"></i>
            <h2 style="color: var(--main);">CREATE ACCOUNT</h2>
            <div style="font-size: 12px; color: #777; margin-bottom: 10px;">*‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (8-12 ‡∏´‡∏•‡∏±‡∏Å)</div>
            <input type="text" id="regUsername" class="login-input" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô)">
            <input type="password" id="regPassword" class="login-input" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button class="btn-buy" onclick="handleRegister()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            <p style="font-size: 14px; margin-top: 15px;">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? <a href="#" onclick="toggleAuth('login')" style="color: var(--main); text-decoration: none; font-weight: 500;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a></p>
        </div>
    </div>

    <div id="loginPage" class="hidden">
        <div class="login-card">
            <i class="fas fa-times btn-close-modal" onclick="closeAuth()"></i>
            <h2 style="color: var(--main);">BAOBEI LOGIN</h2>
            <input type="text" id="loginUsername" class="login-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
            <input type="password" id="loginPassword" class="login-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button class="btn-buy" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <p style="font-size: 14px; margin-top: 15px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="#" onclick="toggleAuth('register')" style="color: var(--main); text-decoration: none; font-weight: 500;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a></p>
            <p style="font-size: 11px; color: #aaa; margin-top: 10px;">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 15 ‡∏ô‡∏≤‡∏ó‡∏µ</p>
        </div>
    </div>

    <div id="shopContent">
        <div class="announcement">‚ú® ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà BAOBEI SHOP | ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏π‡πÅ‡∏• 24 ‡∏ä‡∏°. ‚ú®</div>
        <nav class="navbar">
            <div class="logo" onclick="showPage('home')">BAOBEI SHOP</div>
            <div class="nav-right">
                <div class="user-profile-btn" onclick="openEditProfile()">
                    <img id="navAvatarImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="nav-avatar">
                    <div id="navNickname" class="nav-nickname">
                        <span>‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°</span>
                        <span class="nav-id-badge" style="display:none;" id="navIdBadge">ID: -</span>
                    </div>
                </div>
                
                <div class="cart-tag" onclick="showCart()">
                    <i class="fas fa-shopping-cart"></i> 
                    <span class="cart-count" id="cartCount">0</span>
                </div>
                <button id="adminBtn" class="btn-admin" onclick="openAdminPanel()">
                    <i class="fas fa-user-shield"></i>
                </button>
                <div id="topupBtn" class="balance-tag" onclick="showPage('topup')" style="display:none;">
                    <i class="fas fa-wallet"></i> <span id="balanceDisplay">0</span> ‡∏ø
                </div>
                <button id="authBtn" onclick="toggleAuth('login')" class="btn-auth"><i class="fas fa-sign-in-alt"></i>  ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </nav>

        <div class="container">
            <div id="homePage">
                <div class="banner-container">
                    <img id="mainBannerImg" src="https://lh3.googleusercontent.com/d/1ALVIB9eXw_BXz1By7UBemWyY_0Gp-YoF" alt="Banner" class="banner-img">
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="stat-value"><span id="statStock">0</span> <small style="font-size: 12px; font-weight: 300;">‡∏ä‡∏¥‡πâ‡∏ô</small></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
                        <div class="stat-value"><span id="statUsers">...</span> <small style="font-size: 12px; font-weight: 300;">‡∏Ñ‡∏ô</small></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∞‡∏™‡∏°</div>
                        <div class="stat-value"><span id="statSalesTotal">...</span> <small style="font-size: 12px; font-weight: 300;">‡∏ö‡∏¥‡∏•</small></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</div>
                        <div class="stat-value"><span id="statTopupTotal">...</span> <small style="font-size: 12px; font-weight: 300;">‡∏ø</small></div>
                    </div>
                </div>

                <div style="text-align: center; margin-bottom: 10px; font-weight: 500; color: #555; letter-spacing: 1px;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                <div class="contact-container">
                    <a href="https://www.facebook.com/share/1AYfq313Xe/?mibextid=wwXIfr" target="_blank" class="social-btn social-fb">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </a>
                    <a href="https://line.me/R/ti/p/@989lkmme" target="_blank" class="social-btn social-line">
                        <i class="fab fa-line"></i> Line Official
                    </a>
                </div>
                
                <div class="title-bar">
                    <h2><i class="fas fa-shopping-bag"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
                    <button id="historyBtn" class="btn-history" onclick="showOrderHistory()" style="display:none;"><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</button>
                </div>
                <div id="productList" class="product-grid"></div>
            </div>

            <div id="topupPage" class="hidden">
                <div class="topup-card">
                    <h3 style="margin-top:0"><i class="fas fa-university"></i> ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                    
                    <div class="qr-section">
                        <p style="font-weight: bold; color: var(--bank); margin: 5px 0;">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ô‡∏≤‡∏Ñ‡∏¥‡∏ô‡∏†‡∏±‡∏ó‡∏£ (KKP)</p>
                        <p style="font-size: 20px; letter-spacing: 1px; font-weight: bold; color: #000;">201-201-9014</p>
                        <div style="height: 1px; background: #eee; margin: 10px 0;"></div>
                        <p style="font-weight: bold; color: #f59e0b; margin: 5px 0;">TrueMoney Wallet</p>
                        <p style="font-size: 20px; letter-spacing: 1px; font-weight: bold; color: #000;">080-920-0932</p>
                        <p style="font-size: 14px; margin: 10px 0 0 0;">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏à‡∏¥‡∏ï‡∏£‡∏≤‡∏†‡∏£‡∏ì‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£</p>
                        <img id="qrCodeImg" src="https://lh3.googleusercontent.com/d/1ardGOoNH5cU-qLoTaZ7VHLs8kUCriNmX" alt="QR Code" style="margin-top: 15px; width: 180px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    </div>
                    
                    <div style="background:#fff3cd; color:#856404; padding:10px; border-radius:10px; font-size:13px; margin-bottom:15px; border:1px solid #ffeeba;">
                        <b>‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô:</b> ‡∏´‡∏≤‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏≠‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤ ‡πÅ‡∏à‡πâ‡∏á "‡πÄ‡∏•‡∏Ç ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" ‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
                    </div>

                    <input type="number" id="topupAmount" class="login-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô">
                    
                    <div style="margin-top: 10px;">
                        <label for="slipInput" style="display: block; cursor: pointer; background: #f0f0f0; padding: 12px; border-radius: 12px; font-size: 14px; border: 1px solid #ddd;">
                            <i class="fas fa-file-invoice"></i> ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        </label>
                        <input type="file" id="slipInput" accept="image/*" class="hidden" onchange="previewSlip(this)">
                        <img id="slipPreviewImg" class="slip-preview">
                    </div>

                    <button class="btn-buy" onclick="submitTopup()" style="margin-top: 20px;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÇ‡∏≠‡∏ô</button>
                    <p onclick="showPage('home')" style="cursor:pointer; margin-top:20px; color:#999; font-size: 14px;"><i class="fas fa-chevron-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</p>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-widget" id="chatBox">
        <div class="chat-header">
            <span><i class="fas fa-comments"></i> <span id="chatTitle">Global Chat</span></span>
            <i class="fas fa-times" style="cursor:pointer" onclick="toggleWebChat()"></i>
        </div>
        <div class="chat-tabs">
            <div id="tabGlobal" class="chat-tab active" onclick="setChatMode('global')">‡πÅ‡∏ä‡∏ó‡∏£‡∏ß‡∏°</div>
            <div id="tabPrivate" class="chat-tab" onclick="setChatMode('private')">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß)</div>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div style="padding: 10px; border-top: 1px solid #eee; display: flex; gap: 5px; background: #fff; align-items: center;">
            <input type="file" id="chatImageInput" hidden accept="image/*" onchange="handleChatImage(this)">
            <button onclick="document.getElementById('chatImageInput').click()" style="background: #eee; color: #555; border:none; width: 35px; height: 35px; border-radius: 50%; cursor:pointer; flex-shrink: 0;"><i class="fas fa-image"></i></button>
            <input type="text" id="chatInput" style="flex:1; border: 1px solid #ddd; padding: 8px 12px; border-radius: 20px; outline:none;" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
            <button onclick="sendChat()" style="background: var(--main); color:white; border:none; width: 35px; height: 35px; border-radius: 50%; cursor:pointer; flex-shrink: 0;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
    <div class="floating-chat" onclick="toggleWebChat()"><i class="fas fa-comment-dots"></i></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        window.showLoader = function(show) { document.getElementById('global-loader').style.display = show ? 'flex' : 'none'; }

        const firebaseConfig = {
          apiKey: "AIzaSyDEknKwZ39jTy_vnsazCjE63EAlBIVXk4o",
          authDomain: "baobei-shop-81226.firebaseapp.com",
          databaseURL: "https://baobei-shop-81226-default-rtdb.firebaseio.com",
          projectId: "baobei-shop-81226",
          storageBucket: "baobei-shop-81226.firebasestorage.app",
          messagingSenderId: "204448093148",
          appId: "1:204448093148:web:6ddadd6d03c599cfeab519"
        };

        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            db = getDatabase(app);
            console.log("Firebase Connected");
        } catch (e) {
            console.error("Firebase Error: ", e);
            Swal.fire('Config Error', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Config', 'error');
        }

        window.ADMIN_AVATAR_URL = "https://lh3.googleusercontent.com/d/12RhOdgaJigGJCiIBURsppbEyBPmBhBT7";
        window.BOT_AVATAR_URL = "https://cdn-icons-png.flaticon.com/512/4712/4712035.png";

        window.PRODUCTS = [
            { id: 1, name: "email(‡∏ô‡∏≠‡∏Å) ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó / ‡∏ï‡∏¥‡∏î‡πÅ‡∏û‡πá‡∏Ñ", price: 9, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 2, name: "email(‡∏ô‡∏≠‡∏Å) ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡πÅ‡∏û‡πá‡∏Ñ / ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥", price: 11, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 3, name: "emailThai ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ / ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡πÅ‡∏û‡πá‡∏Ñ", price: 11, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 4, name: "emailThai ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡πÅ‡∏û‡πá‡∏Ñ / ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ", price: 12, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 5, name: "emailThai ‡∏ï‡∏¥‡∏î‡πÅ‡∏û‡πá‡∏Ñ / ‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ", price: 13, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" },
            { id: 6, name: "emailThai ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ / ‡∏ï‡∏¥‡∏î‡πÅ‡∏û‡πá‡∏Ñ ", price: 18, image: "https://lh3.googleusercontent.com/d/1JdUzWjV-sWQkS6vHCekLb7HN9Uc6g4J7" }
        ];

        let state = {
            users: {},
            products: window.PRODUCTS, 
            inventory: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [] },
            topupRequests: [],
            usedSlips: [],
            salesCount: 1089,
            totalTopupSum: 2581,
            customUserCount: 703,
            currentUser: null,
            isAdmin: false,
            isModerator: false, 
            activePrivateUser: null,
            globalMessages: [],
            privateMessages: {},
            chatMode: 'global',
            cart: [],
            moderators: [],
            botConfig: { active: false, interval: 60, text: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡πâ‡∏≤‡∏ô BAOBEI SHOP! ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏°.", image: null, avatar: null, lastRun: 0 },
            coupons: {},
            siteImages: {
                background: "https://lh3.googleusercontent.com/d/1tgohnqPTuEtMOrhLQ_YMF7nqqQZETbsx",
                banner: "https://lh3.googleusercontent.com/d/1ALVIB9eXw_BXz1By7UBemWyY_0Gp-YoF",
                qr: "https://lh3.googleusercontent.com/d/1ardGOoNH5cU-qLoTaZ7VHLs8kUCriNmX",
                adminAvatar: "https://lh3.googleusercontent.com/d/12RhOdgaJigGJCiIBURsppbEyBPmBhBT7"
            },
            lastUpdated: Date.now() // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏Å‡πâ cache ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á Cache URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        const noCache = (url) => {
            if (!url) return "";
            if (url.startsWith('data:')) return url;
            const sep = url.includes('?') ? '&' : '?';
            return `${url}${sep}t=${state.lastUpdated}`;
        };

        if(db) {
            const shopRef = ref(db, 'baobei_shop_data');
            onValue(shopRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const currentUser = state.currentUser;
                    const isAdmin = state.isAdmin;
                    const isModerator = state.isModerator;
                    const cart = state.cart;
                    const chatMode = state.chatMode;
                    const activePrivateUser = state.activePrivateUser;
                    
                    state = { ...state, ...data, lastUpdated: Date.now() }; 
                    
                    // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Client
                    state.currentUser = currentUser;
                    state.isAdmin = isAdmin;
                    state.isModerator = isModerator;
                    state.cart = cart;
                    state.chatMode = chatMode;
                    state.activePrivateUser = activePrivateUser;
                    
                    updateUI();
                    console.log("Data Sync: Real-time update applied.");
                } else {
                    persist();
                }
            });
        }

        window.persist = function() {
            if(!db) return;
            const dataToSave = { ...state };
            delete dataToSave.currentUser;
            delete dataToSave.isAdmin;
            delete dataToSave.isModerator;
            delete dataToSave.cart;
            delete dataToSave.activePrivateUser;
            delete dataToSave.chatMode;
            delete dataToSave.lastUpdated;

            set(ref(db, 'baobei_shop_data'), dataToSave);
        };
        
        window.generateID = function() {
            const length = Math.floor(Math.random() * (12 - 8 + 1)) + 8;
            let id = '';
            for (let i = 0; i < length; i++) {
                id += Math.floor(Math.random() * 10).toString();
            }
            return id;
        }

        window.checkAuth = function() {
            if (!state.currentUser) { Swal.fire({ icon: 'warning', title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', showCancelButton: true, confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' }).then((res) => { if (res.isConfirmed) toggleAuth('login'); }); return false; }
            return true;
        }

        window.handleLogin = function() { 
            const u = document.getElementById('loginUsername').value.trim(); const p = document.getElementById('loginPassword').value.trim(); 
            showLoader(true);
            setTimeout(() => { 
                if(u.toLowerCase() === 'admin' && p === 'yongchai07') { state.currentUser = "Admin"; state.isAdmin = true; closeAuth(); updateUI(); showLoader(false); return Swal.fire('Admin Login', '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', 'success'); } 
                let foundUserID = null; const userKeys = Object.keys(state.users);
                for (let key of userKeys) { if (state.users[key].username === u && state.users[key].password === p) { foundUserID = key; break; } }
                showLoader(false);
                if(foundUserID) { if (state.users[foundUserID].isBanned) { return Swal.fire('‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö', '‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô', 'error'); }
                    state.currentUser = foundUserID; state.isAdmin = false; closeAuth(); updateUI(); Swal.fire('‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö', `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${u}`, 'success'); 
                } else { return Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error'); } 
            }, 600);
        }

        window.handleRegister = function() { 
            const u = document.getElementById('regUsername').value.trim(); const p = document.getElementById('regPassword').value.trim(); 
            if(!u || !p) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'warning'); 
            showLoader(true);
            setTimeout(() => {
                let newID = generateID(); while (state.users[newID]) { newID = generateID(); }
                state.users[newID] = { username: u, password: p, balance: 0, orders: [], nickname: u, avatar: null, isBanned: false, id: newID }; 
                state.customUserCount = (state.customUserCount || 0) + 1;
                persist(); updateUI(); showLoader(false);
                Swal.fire({ title: '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', html: `ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: <b style="font-size:24px; color:var(--main);">${newID}</b><br>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ "${u}" ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢`, icon: 'success' }).then(() => toggleAuth('login')); 
            }, 800);
        }

        window.updateUI = function() {
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û Real-time ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏Å‡πâ Cache
            if(state.siteImages) {
                document.body.style.backgroundImage = `url('${noCache(state.siteImages.background)}')`;
                if(document.getElementById('mainBannerImg')) document.getElementById('mainBannerImg').src = noCache(state.siteImages.banner);
                if(document.getElementById('qrCodeImg')) document.getElementById('qrCodeImg').src = noCache(state.siteImages.qr);
                window.ADMIN_AVATAR_URL = noCache(state.siteImages.adminAvatar);
            }

            if(document.getElementById('statSalesTotal')) document.getElementById('statSalesTotal').innerText = (state.salesCount || 0).toLocaleString();
            if(document.getElementById('statUsers')) document.getElementById('statUsers').innerText = (state.customUserCount || 0).toLocaleString();
            if(document.getElementById('statTopupTotal')) document.getElementById('statTopupTotal').innerText = Math.floor(state.totalTopupSum || 0).toLocaleString();
            
            let totalStock = 0;
            if(state.inventory) totalStock = Object.values(state.inventory).reduce((a, b) => a + (b ? b.length : 0), 0);
            if(document.getElementById('statStock')) document.getElementById('statStock').innerText = totalStock;
            
            const authBtn = document.getElementById('authBtn');
            const topupBtn = document.getElementById('topupBtn');
            const historyBtn = document.getElementById('historyBtn');
            const navNickname = document.getElementById('navNickname') ? document.getElementById('navNickname').querySelector('span:first-child') : null;
            const navIdBadge = document.getElementById('navIdBadge');

            if (state.currentUser) {
                const user = (state.currentUser === "Admin") ? { balance: 0, nickname: "Admin", avatar: null } : state.users[state.currentUser] || {};
                
                if(document.getElementById('balanceDisplay')) document.getElementById('balanceDisplay').innerText = (user.balance || 0).toLocaleString();
                if(navNickname) navNickname.innerText = user.nickname || user.username || state.currentUser;
                if(navIdBadge) {
                    if (state.currentUser !== "Admin") { navIdBadge.innerText = `ID: ${state.currentUser}`; navIdBadge.style.display = 'block'; } 
                    else { navIdBadge.style.display = 'none'; }
                }
                
                let avatarUrl = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
                if(state.isAdmin) avatarUrl = ADMIN_AVATAR_URL; else if(user.avatar) avatarUrl = noCache(user.avatar);
                if(document.getElementById('navAvatarImg')) document.getElementById('navAvatarImg').src = avatarUrl;

                if (state.isAdmin || (state.moderators && state.moderators.includes(state.currentUser))) {
                    document.getElementById('adminBtn').style.display = "block"; state.isModerator = !state.isAdmin;
                }
                if(topupBtn) topupBtn.style.display = 'flex'; if(historyBtn) historyBtn.style.display = 'block';
                if(authBtn) { authBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i>'; authBtn.onclick = handleLogout; authBtn.style.background = '#eee'; }
            } else {
                if(navNickname) navNickname.innerText = "‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°"; if(navIdBadge) navIdBadge.style.display = 'none';
                if(document.getElementById('navAvatarImg')) document.getElementById('navAvatarImg').src = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
                if(document.getElementById('adminBtn')) document.getElementById('adminBtn').style.display = "none"; 
                if(topupBtn) topupBtn.style.display = 'none'; if(historyBtn) historyBtn.style.display = 'none';
                if(authBtn) { authBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i>  ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'; authBtn.onclick = () => toggleAuth('login'); authBtn.style.background = '#eee'; }
            }
            
            const list = document.getElementById('productList');
            if(list && state.products) {
                list.innerHTML = state.products.map(p => {
                    const stock = (state.inventory && state.inventory[p.id]) ? state.inventory[p.id].length : 0;
                    return `<div class="product-card">
                        <div class="stock-tag">${stock > 0 ? '‡∏™‡∏ï‡πá‡∏≠‡∏Å: ' + stock : '‡∏´‡∏°‡∏î'}</div>
                        <img src="${noCache(p.image)}" class="product-img" loading="lazy">
                        <div class="product-info">
                            <div class="product-name">${p.name}</div>
                            <div class="product-price">${p.price} ‡∏ø</div>
                            <button class="btn-buy" onclick="buyProduct(${p.id})" ${stock === 0 && !state.isAdmin && !state.isModerator ? 'disabled' : ''}>${(state.isAdmin || state.isModerator) ? '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ã‡∏∑‡πâ‡∏≠' : (stock > 0 ? '‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ' : '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î')}</button>
                            <button class="btn-add-cart" onclick="addToCart(${p.id})" ${stock === 0 ? 'style="display:none"' : ''}><i class="fas fa-cart-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
                        </div>
                    </div>`;
                }).join('');
            }
            renderChat(); updateCartBadge();
        }

        window.toggleAuth = function(type) { document.getElementById('loginPage').classList.toggle('hidden', type !== 'login'); document.getElementById('registerPage').classList.toggle('hidden', type !== 'register'); }
        window.closeAuth = function() { document.getElementById('loginPage').classList.add('hidden'); document.getElementById('registerPage').classList.add('hidden'); }
        window.handleLogout = function() { state.currentUser = null; state.isAdmin = false; state.isModerator = false; location.reload(); }
        
        window.openEditProfile = function() { 
            if(!checkAuth()) return; if(state.isAdmin) return Swal.fire('Admin', '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'info'); const user = state.users[state.currentUser]; 
            Swal.fire({ title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß', html: `<div style="text-align:center;"><img id="editProfilePreview" src="${user.avatar ? noCache(user.avatar) : 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" style="width:100px; height:100px; border-radius:50%; object-fit:cover; margin-bottom:15px; border:3px solid var(--main);"><br><label class="btn-history" style="display:inline-block; margin-bottom:15px; cursor:pointer;">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå <input type="file" id="profilePicInput" hidden accept="image/*" onchange="previewProfileEdit(this)"></label><div style="background:#f9f9f9; padding:10px; border-radius:8px; border:1px dashed #ccc; margin-bottom:15px;"><div style="font-size:12px; color:#555;">USER ID (‡πÉ‡∏ä‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)</div><div style="font-size:24px; font-weight:bold; color:var(--main); letter-spacing:2px; font-family:monospace;">${state.currentUser}</div></div><div style="text-align:left; font-size:14px; margin-bottom:5px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Login)</div><input type="text" value="${user.username}" class="login-input" disabled style="background:#f0f0f0; color:#888;"><div style="text-align:left; font-size:14px; margin-bottom:5px; margin-top:10px;">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</div><input type="text" id="editNickname" class="login-input" value="${user.nickname || ''}" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"></div>`, showCancelButton: true, confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', preConfirm: () => { return { nickname: document.getElementById('editNickname').value, avatar: document.getElementById('editProfilePreview').src } } }).then((result) => { if (result.isConfirmed) { state.users[state.currentUser].nickname = result.value.nickname; state.users[state.currentUser].avatar = result.value.avatar; persist(); updateUI(); Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success'); } }); 
        }
        window.previewProfileEdit = function(input) { if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = (e) => { document.getElementById('editProfilePreview').src = e.target.result; }; reader.readAsDataURL(input.files[0]); } }

        window.showPublicProfile = function(uidOrName) { let user; let isAdmin = (uidOrName === "Admin"); let isBot = (uidOrName === "Admin Bot"); if (isAdmin) user = { nickname: "Admin", avatar: ADMIN_AVATAR_URL, orders: [] }; else if (isBot) user = { nickname: "Admin Bot", avatar: state.botConfig.avatar || BOT_AVATAR_URL, orders: [] }; else user = state.users[uidOrName]; if (!user) return; const orderCount = user.orders ? user.orders.length : 0; Swal.fire({ title: '‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', html: `<div style="text-align:center;"><img src="${user.avatar ? noCache(user.avatar) : 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--main); object-fit:cover;"><h3 style="margin:10px 0 5px 0;">${user.nickname || user.username}</h3>${isBot ? '<p style="color:var(--bot); font-weight:bold;">ü§ñ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>' : `<p style="margin:0; color:#888;">ID: ${uidOrName}</p>`}${isAdmin ? '<p style="color:var(--main); font-weight:bold;">üëë Administrator</p>' : ''}<hr style="margin:15px 0; border:0; border-top:1px solid #eee;"><div style="display:flex; justify-content:space-around;"><div><small>‡∏¢‡∏≠‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small><br><b>${(isAdmin||isBot) ? 'N/A' : orderCount}</b> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div></div></div>`, showConfirmButton: false }); }
        
        window.addToCart = function(id) { if(!checkAuth()) return; const p = state.products.find(item => item.id === id); const stock = (state.inventory && state.inventory[id]) ? state.inventory[id].length : 0; const itemInCart = state.cart.find(i => i.id === id); const currentQty = itemInCart ? itemInCart.qty : 0; if (stock > currentQty) { if (itemInCart) { itemInCart.qty++; itemInCart.price = p.price; } else state.cart.push({ id: id, name: p.name, price: p.price, qty: 1 }); updateCartBadge(); Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß', showConfirmButton: false, timer: 1000 }); } else { Swal.fire('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠', '‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠', 'warning'); } }
        window.updateCartBadge = function() { const count = state.cart.reduce((sum, item) => sum + item.qty, 0); if(document.getElementById('cartCount')) document.getElementById('cartCount').innerText = count; }
        window.showCart = function() { if(!checkAuth()) return; if (state.cart.length === 0) return Swal.fire('‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'info'); let total = 0; let html = `<div style="text-align:left; max-height:300px; overflow-y:auto;">`; state.cart.forEach((item, index) => { const subtotal = item.price * item.qty; total += subtotal; html += `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;"><div><b>${item.name}</b><br><small>${item.price}‡∏ø x ${item.qty}</small></div><div style="display:flex; align-items:center; gap:10px;"><b>${subtotal}‡∏ø</b><button onclick="state.cart.splice(${index},1); updateCartBadge(); Swal.close(); showCart();" style="border:none; color:red; cursor:pointer;">‚ùå</button></div></div>`; }); html += `</div><div style="margin-top:15px; border-top:2px dashed #eee; padding-top:10px;"><input type="text" id="couponCode" class="login-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" style="margin-bottom:5px;"></div><h3 style="text-align:right; color:var(--main); margin-top:5px;">‡∏£‡∏ß‡∏°: <span id="cartTotal">${total}</span> ‡∏ø</h3>`; Swal.fire({ title: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', html: html, showCancelButton: true, confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠', preConfirm: () => { const code = document.getElementById('couponCode').value.trim(); return { code: code, total: total }; } }).then((result) => { if (result.isConfirmed) { processBulkBuy(result.value.total, result.value.code); } }); }
        
        window.processBulkBuy = function(totalPrice, couponCode) { const user = state.users[state.currentUser]; const hasPrivilege = (state.isAdmin || state.isModerator); let discount = 0; if (couponCode && state.coupons[couponCode]) { discount = state.coupons[couponCode]; if (discount <= 0) return Swal.fire('‡πÇ‡∏Ñ‡πâ‡∏î‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'error'); } else if (couponCode) { return Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î', '‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error'); } let finalPrice = totalPrice - discount; if(finalPrice < 0) finalPrice = 0; if (!hasPrivilege && user.balance < finalPrice) return Swal.fire('‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠', `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ${finalPrice}‡∏ø (‡∏•‡∏î‡πÑ‡∏õ ${discount}‡∏ø) ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏û‡∏≠`, 'warning').then(() => showPage('topup')); showLoader(true); setTimeout(() => { if (!hasPrivilege) user.balance -= finalPrice; let boughtItems = []; state.cart.forEach(item => { for(let i=0; i < item.qty; i++) { const code = state.inventory[item.id].pop(); boughtItems.push({ name: item.name, code: code }); if (!hasPrivilege) { if(!user.orders) user.orders = []; user.orders.unshift({ name: item.name, code: code, date: new Date().toLocaleString() }); } state.salesCount++; } }); state.cart = []; updateCartBadge(); persist(); updateUI(); let msg = discount > 0 ? `‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î ${couponCode} ‡∏•‡∏î‡πÑ‡∏õ ${discount}‡∏ø` : ''; showLoader(false); Swal.fire({ title: '‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', html: `<p style="color:green">${msg}</p><div style="text-align:left; background:#f4f4f4; padding:15px; border-radius:10px; max-height:300px; overflow-y:auto;">` + boughtItems.map(b => `<div style="margin-bottom:5px;"><b>${b.name}:</b> ${b.code}</div>`).join('') + `</div>`, icon: 'success' }); }, 800); }
        window.previewSlip = function(input) { if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = (e) => { document.getElementById('slipPreviewImg').src = e.target.result; document.getElementById('slipPreviewImg').style.display = 'block'; }; reader.readAsDataURL(input.files[0]); } }
        window.submitTopup = function() { if(!checkAuth()) return; const amt = parseFloat(document.getElementById('topupAmount').value); const slipImg = document.getElementById('slipPreviewImg').src; if(!amt || amt <= 0) return Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', 'warning'); if(!slipImg || slipImg.length < 100) return Swal.fire('‡∏Ç‡∏≤‡∏î‡∏™‡∏•‡∏¥‡∏õ', '‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ', 'warning'); const slipHash = slipImg.substring(slipImg.length - 200); if(state.usedSlips && state.usedSlips.includes(slipHash)) return Swal.fire('‡∏ã‡πâ‡∏≥', '‡∏™‡∏•‡∏¥‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß', 'error'); showLoader(true); setTimeout(() => { state.users[state.currentUser].balance += amt; state.totalTopupSum += amt; if(!state.usedSlips) state.usedSlips = []; state.usedSlips.push(slipHash); if(!state.topupRequests) state.topupRequests = []; state.topupRequests.push({ user: state.users[state.currentUser].username, id: state.currentUser, amount: amt, slip: slipImg, time: new Date().toLocaleString() }); persist(); updateUI(); showLoader(false); Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡πÄ‡∏ï‡∏¥‡∏° ${amt}‡∏ø`, 'success').then(() => showPage('home')); }, 1500); }
        window.buyProduct = function(id) { if(!checkAuth()) return; const p = state.products.find(item => item.id === id); const user = state.users[state.currentUser]; const hasPriv = (state.isAdmin || state.isModerator); if(!hasPriv && user.balance < p.price) return Swal.fire('‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠', '‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô', 'warning').then(() => showPage('topup')); showLoader(true); setTimeout(() => { if(state.inventory[id] && state.inventory[id].length > 0) { const code = state.inventory[id].pop(); if(!hasPriv) { user.balance -= p.price; if(!user.orders) user.orders = []; user.orders.unshift({ name: p.name, code: code, date: new Date().toLocaleString() }); } state.salesCount++; persist(); updateUI(); showLoader(false); Swal.fire({ title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', html: `CODE: <b>${code}</b>`, icon: 'success' }); } else { showLoader(false); Swal.fire('‡∏´‡∏°‡∏î', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î', 'error'); } }, 600); }
        window.showOrderHistory = function() { if(!checkAuth()) return; const user = state.users[state.currentUser]; if (!user.orders || user.orders.length === 0) return Swal.fire('‡∏ß‡πà‡∏≤‡∏á', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥', 'info'); let h = user.orders.map(o => `<div style="background:#fff; border:1px solid #eee; padding:10px; margin-bottom:5px; text-align:left;"><small>${o.date}</small><br><b>${o.name}</b><br><code>${o.code}</code></div>`).join(''); Swal.fire({ title: '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥', html: `<div style="max-height:400px; overflow-y:auto;">${h}</div>` }); }

        window.filterUserList = function(text) { const rows = document.querySelectorAll('.user-list-item'); rows.forEach(row => { const name = row.getAttribute('data-name').toLowerCase(); if (name.includes(text.toLowerCase())) { row.style.display = 'flex'; } else { row.style.display = 'none'; } }); };
        window.addStock = function() { const pid = document.getElementById('adm_pid').value; const rawCodes = document.getElementById('adm_codes').value; const isTwoLine = document.getElementById('adm_2lines').checked; if (!rawCodes.trim()) { return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'warning'); } showLoader(true); setTimeout(() => { const rawLines = rawCodes.split('\n').filter(l => l.trim() !== ""); let codes = []; if (isTwoLine) { for(let i=0; i < rawLines.length; i+=2) { let item = rawLines[i]; if(rawLines[i+1]) item += " | " + rawLines[i+1]; codes.push(item); } } else { codes = rawLines; } if(codes.length > 0) { if(!state.inventory[pid]) state.inventory[pid] = []; state.inventory[pid].push(...codes); persist(); updateUI(); openAdminPanel(); showLoader(false); Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${codes.length} ‡∏ä‡∏¥‡πâ‡∏ô ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, showConfirmButton: false, timer: 1500 }); } else { showLoader(false); } }, 500); };
        window.adminTopup = function(targetKey = null, targetAmount = null) { if(!targetKey) targetKey = document.getElementById('topupTarget').value.trim(); if(!targetAmount) targetAmount = parseFloat(document.getElementById('topupAmountInput').value); if(targetKey && !targetAmount && isNaN(targetAmount)) { Swal.fire({ title: `‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ ${targetKey}`, input: 'number', inputLabel: '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', showCancelButton: true, confirmButtonText: '‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô', }).then((result) => { if (result.isConfirmed) { adminTopup(targetKey, parseFloat(result.value)); } }); return; } let userID = null; if (state.users[targetKey]) { userID = targetKey; } else { const keys = Object.keys(state.users); for(let k of keys) { if(state.users[k].username === targetKey) { userID = k; break; } } } if (!userID) { return Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏û‡∏ö ID ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'error'); } if (isNaN(targetAmount) || targetAmount <= 0) { return Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error'); } state.users[userID].balance += targetAmount; state.totalTopupSum += targetAmount; persist(); updateUI(); openAdminPanel(); Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡πÄ‡∏ï‡∏¥‡∏° ${targetAmount}‡∏ø ‡πÉ‡∏´‡πâ ${state.users[userID].username} (ID: ${userID}) ‡πÅ‡∏•‡πâ‡∏ß`, 'success'); };
        window.clearStock = function() { const pid = parseInt(document.getElementById('adm_pid').value); const p = state.products.find(item => item.id === pid); const count = state.inventory[pid] ? state.inventory[pid].length : 0; if(count === 0) return Swal.fire('‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', 'info'); Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å?', html: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å <b>${p.name}</b><br>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${count} ‡∏ä‡∏¥‡πâ‡∏ô ‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?`, icon: 'warning', showCancelButton: true, confirmButtonColor: '#dc3545', confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' }).then((result) => { if (result.isConfirmed) { state.inventory[pid] = []; persist(); updateUI(); openAdminPanel(); Swal.fire('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '‡∏•‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß', 'success'); } }); };
        window.editStats = function() { Swal.fire({ title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤', html: `<div style="text-align:left; font-size:14px; margin-bottom:5px;">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∞‡∏™‡∏° (‡∏ö‡∏¥‡∏•)</div><input type="number" id="editSales" class="swal2-input" value="${state.salesCount}" style="margin-bottom:15px;"><div style="text-align:left; font-size:14px; margin-bottom:5px;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡∏Ñ‡∏ô)</div><input type="number" id="editUsers" class="swal2-input" value="${state.customUserCount}" style="margin-bottom:15px;"><div style="text-align:left; font-size:14px; margin-bottom:5px;">‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏ø)</div><input type="number" id="editTopup" class="swal2-input" value="${state.totalTopupSum}">`, showCancelButton: true, confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', preConfirm: () => { return { sales: parseInt(document.getElementById('editSales').value) || 0, users: parseInt(document.getElementById('editUsers').value) || 0, topup: parseFloat(document.getElementById('editTopup').value) || 0 } } }).then((result) => { if (result.isConfirmed) { state.salesCount = result.value.sales; state.customUserCount = result.value.users; state.totalTopupSum = result.value.topup; persist(); updateUI(); openAdminPanel(); Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success'); } }); };
        window.toggleBan = function() { const target = document.getElementById('banTarget').value.trim(); if(!target || !state.users[target]) return Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ ID ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error'); if(target === 'Admin') return Swal.fire('‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', '‡πÅ‡∏ö‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'error'); state.users[target].isBanned = !state.users[target].isBanned; persist(); openAdminPanel(); if(state.users[target].isBanned) { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡πÅ‡∏ö‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${target} ‡πÅ‡∏•‡πâ‡∏ß`, 'success'); } else { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${target} ‡πÅ‡∏•‡πâ‡∏ß`, 'success'); } };
        
        window.saveSiteImages = async function() {
            showLoader(true);
            const getImgValue = async (inputId, fileId, currentVal) => {
                const fileInput = document.getElementById(fileId);
                const textInput = document.getElementById(inputId).value;
                if (fileInput && fileInput.files && fileInput.files[0]) {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve(e.target.result);
                        reader.readAsDataURL(fileInput.files[0]);
                    });
                }
                return textInput || currentVal;
            };

            if (!state.siteImages) state.siteImages = {};

            state.siteImages.background = await getImgValue('img_bg', 'file_bg', state.siteImages.background);
            state.siteImages.banner = await getImgValue('img_banner', 'file_banner', state.siteImages.banner);
            state.siteImages.qr = await getImgValue('img_qr', 'file_qr', state.siteImages.qr);
            state.siteImages.adminAvatar = await getImgValue('img_admin', 'file_admin', state.siteImages.adminAvatar);

            persist();
            // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞ sync ‡∏ú‡πà‡∏≤‡∏ô onValue ‡πÄ‡∏≠‡∏á
            showLoader(false);
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        };

        window.saveProductPrices = function() {
            state.products.forEach((p, index) => {
                const newPriceInput = document.getElementById(`edit_price_${index}`);
                if (newPriceInput) {
                    const newPrice = parseFloat(newPriceInput.value);
                    if (!isNaN(newPrice) && newPrice >= 0) {
                        p.price = newPrice;
                    }
                }
            });
            persist();
            updateUI();
            openAdminPanel();
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        };

        window.openAdminPanel = function() {
            let userListHTML = Object.entries(state.users).map(([uid, u]) => { let isBan = u.isBanned; let avatar = u.avatar ? noCache(u.avatar) : 'https://cdn-icons-png.flaticon.com/512/149/149071.png'; return `<div class="user-list-item" data-name="${u.username}" style="display:flex; justify-content:space-between; align-items:center; padding:10px; background:white; margin-bottom:8px; border-radius:8px; border:1px solid ${isBan ? '#dc3545' : '#eee'}; box-shadow: 0 2px 5px rgba(0,0,0,0.02);"><div style="display:flex; align-items:center; gap:10px;"><img src="${avatar}" style="width:40px; height:40px; border-radius:50%; object-fit:cover; border:2px solid ${isBan ? '#dc3545' : '#eee'};"><div style="text-align:left;"><div style="font-weight:bold; font-size:14px; ${isBan ? 'color:#dc3545' : 'color:#333'}">${u.username} <span style="font-weight:normal; color:#888;">(ID: ${uid})</span> ${isBan ? '<i class="fas fa-ban"></i>' : ''}</div><div style="font-size:11px; color:#666;"><i class="fas fa-coins" style="color:#ffc107"></i> ${u.balance.toLocaleString()}‡∏ø | <span style="color:#888;">${u.nickname || '-'}</span></div></div></div><div style="display:flex; gap:5px;"><button onclick="adminTopup('${uid}')" style="background:var(--line); color:white; border:none; padding:6px 10px; border-radius:5px; cursor:pointer; font-size:11px;" title="‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πà‡∏ß‡∏ô">üí∞</button><button onclick="document.getElementById('banTarget').value = '${uid}'; toggleBan();" style="background:${isBan ? '#28a745' : '#dc3545'}; color:white; border:none; padding:6px 12px; border-radius:5px; cursor:pointer; font-size:11px; transition:0.3s;">${isBan ? '‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô' : '‡πÅ‡∏ö‡∏ô'}</button></div></div>`; }).join('') || '<div style="text-align:center; padding:20px; color:#999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>';
            let reqHtml = (state.topupRequests ? state.topupRequests.slice(-5).reverse() : []).map((req) => `<div style="background:#fff; border:1px solid #ddd; padding:10px; margin-bottom:5px; text-align:left;"><p style="margin:0; font-size:12px;"><b>User:</b> ${req.user} (ID:${req.id || '-'}) | <b>‡∏¢‡∏≠‡∏î:</b> ${req.amount}‡∏ø</p><img src="${req.slip}" style="width:100%; border-radius:5px; margin:5px 0;"></div>`).join('') || "<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>";
            let chatUsers = Object.keys(state.privateMessages || {}).map(user => `<div style="display:flex; gap:5px; margin-bottom:5px;"><button onclick="adminSelectUser('${user}')" style="flex:1; padding:10px; border-radius:8px; border:1px solid #ddd; background:#fff; text-align:left;"><i class="fas fa-user"></i> ${user}</button><button onclick="deletePrivateChat('${user}')" style="width:45px; border-radius:8px; border:none; background:var(--danger); color:white;"><i class="fas fa-trash-alt"></i></button></div>`).join('') || "<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ä‡∏ó</p>";
            let botImgHtml = state.botConfig.image ? `<div style="margin:10px 0; text-align:center; background:#fff; padding:10px; border:1px dashed #ccc; border-radius:5px;"><img src="${state.botConfig.image}" style="max-height:100px; max-width:100%; border-radius:5px;"><br><button onclick="deleteBotImage()" style="background:#dc3545; color:white; border:none; padding:4px 10px; border-radius:4px; font-size:12px; cursor:pointer; margin-top:5px;"><i class="fas fa-trash"></i> ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á</button></div>` : '<div style="font-size:12px; color:#999; margin:5px 0;">(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏ô‡∏ö)</div>';
            let botAvatarHtml = state.botConfig.avatar ? `<div style="margin-top:5px; text-align:center;"><img src="${noCache(state.botConfig.avatar)}" style="width:60px; height:60px; border-radius:50%; object-fit:cover; border:2px solid #ccc;"><br><button onclick="resetBotAvatar()" style="font-size:10px;">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏π‡∏õ</button></div>` : `<div style="margin-top:5px; text-align:center;"><img src="${window.BOT_AVATAR_URL}" style="width:60px; height:60px; border-radius:50%; object-fit:cover; opacity:0.5;"></div>`;
            let couponList = Object.keys(state.coupons || {}).map(code => `<div style="display:flex; justify-content:space-between; background:white; padding:8px; border-bottom:1px solid #eee;"><span><b>${code}</b> (‡∏•‡∏î ${state.coupons[code]}‡∏ø)</span><button onclick="deleteCoupon('${code}')" style="color:red; border:none; background:none; cursor:pointer;">‡∏•‡∏ö</button></div>`).join('') || '<div style="padding:10px; text-align:center; color:#999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</div>';
            
            let modManagerHtml = state.isAdmin ? `
                <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd; color:#17a2b8;"><i class="fas fa-images"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö</h4>
                <div style="background:#e0f7fa; padding:15px; border-radius:8px; border:1px solid #b2ebf2;">
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px; font-weight:bold;">‡∏£‡∏π‡∏õ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (Background):</label>
                        <input type="text" id="img_bg" class="login-input" style="margin-top:5px; margin-bottom:5px;" value="${state.siteImages?.background || ''}" placeholder="‡πÉ‡∏™‡πà URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå">
                        <input type="file" id="file_bg" accept="image/*" class="login-input" style="padding:5px; font-size:11px;">
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px; font-weight:bold;">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (Banner):</label>
                        <input type="text" id="img_banner" class="login-input" style="margin-top:5px; margin-bottom:5px;" value="${state.siteImages?.banner || ''}" placeholder="‡πÉ‡∏™‡πà URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå">
                        <input type="file" id="file_banner" accept="image/*" class="login-input" style="padding:5px; font-size:11px;">
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px; font-weight:bold;">‡∏£‡∏π‡∏õ QR Code ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô:</label>
                        <input type="text" id="img_qr" class="login-input" style="margin-top:5px; margin-bottom:5px;" value="${state.siteImages?.qr || ''}" placeholder="‡πÉ‡∏™‡πà URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå">
                        <input type="file" id="file_qr" accept="image/*" class="login-input" style="padding:5px; font-size:11px;">
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px; font-weight:bold;">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå Admin:</label>
                        <input type="text" id="img_admin" class="login-input" style="margin-top:5px; margin-bottom:5px;" value="${state.siteImages?.adminAvatar || ''}" placeholder="‡πÉ‡∏™‡πà URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå">
                        <input type="file" id="file_admin" accept="image/*" class="login-input" style="padding:5px; font-size:11px;">
                    </div>
                    <button onclick="saveSiteImages()" class="btn-buy" style="background:#17a2b8; width:100%;"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
                </div>

                <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd; color:#28a745;"><i class="fas fa-tags"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
                <div style="background:#e8f5e9; padding:15px; border-radius:8px; border:1px solid #c8e6c9;">
                    ${state.products.map((p, index) => `
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <div style="font-size:12px; font-weight:bold; flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; padding-right:10px;">${p.name}</div>
                            <div style="display:flex; gap:5px; align-items:center; width:100px;">
                                <input type="number" id="edit_price_${index}" value="${p.price}" class="login-input" style="margin:0; padding:5px; text-align:center; flex:1; font-size:14px;">
                                <span style="font-size:12px; font-weight:bold; color:#555;">‡∏ø</span>
                            </div>
                        </div>
                    `).join('')}
                    <button onclick="saveProductPrices()" class="btn-buy" style="background:#28a745; width:100%; margin-top:10px;"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>

                <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
                <div style="background:#fffbe6; padding:15px; border-radius:10px; border:1px solid #ffe58f;"><div style="display:flex; gap:5px; margin-bottom:5px;"><select id="adm_pid" class="swal2-input" style="flex:1; margin:0; font-size:14px;">${state.products.map(p=>`<option value="${p.id}">${p.name} (‡∏°‡∏µ ${state.inventory[p.id]?state.inventory[p.id].length:0})</option>`).join('')}</select><button onclick="clearStock()" class="btn-buy" style="width:auto; background:var(--danger); font-size:12px;"><i class="fas fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á</button></div><textarea id="adm_codes" class="swal2-textarea" placeholder="‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î = 1 ‡∏ä‡∏¥‡πâ‡∏ô)" style="height:100px;"></textarea><div style="margin-top:5px; margin-bottom:10px; text-align:left;"><input type="checkbox" id="adm_2lines"> <label for="adm_2lines">‡πÇ‡∏´‡∏°‡∏î 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î = 1 ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label></div><button onclick="addStock()" class="btn-buy" style="width:100%; background:#28a745; font-size:14px;"><i class="fas fa-plus-circle"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></div>

                <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô</h4>
                <div style="display:flex; gap:5px;"><input type="text" id="modTarget" class="login-input" style="flex:1; margin:0;" placeholder="ID User"><button onclick="toggleModerator()" class="btn-buy" style="width:auto; padding:0 15px;">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö</button></div>
                <div style="font-size:12px; margin-top:5px; color:#666;">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (ID): ${(state.moderators || []).join(', ') || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</div>
                
                <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd; color:#6f42c1;">üìä ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡πâ‡∏≤‡∏ô (Fake Stats)</h4>
                <div style="display:flex; align-items:center; justify-content:space-between; background:#f3e5f5; padding:10px; border-radius:8px;">
                    <div style="font-size:12px;"><div>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: <b style="color:var(--main);">${state.salesCount.toLocaleString()}</b></div><div>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: <b style="color:#333;">${state.customUserCount.toLocaleString()}</b></div><div>‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡∏¥‡∏°: <b style="color:var(--line);">${state.totalTopupSum.toLocaleString()}</b></div></div>
                    <button onclick="editStats()" class="btn-buy" style="width:auto; padding:5px 15px; font-size:12px; background:#6f42c1;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </div>

                <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd; color:var(--line);">üí∞ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h4>
                <div style="display:flex; gap:5px;"><input type="text" id="topupTarget" class="login-input" style="flex:1; margin:0;" placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ID"><input type="number" id="topupAmountInput" class="login-input" style="flex:1; margin:0;" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"><button onclick="adminTopup()" class="btn-buy" style="width:auto; padding:0 15px; background:var(--line);">‡πÄ‡∏ï‡∏¥‡∏°</button></div>

                <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd; color:#007bff;">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (${Object.keys(state.users || {}).length})</h4>
                <div style="background:#f8f9fa; padding:10px; border-radius:8px; border:1px solid #ddd;"><input type="text" onkeyup="filterUserList(this.value)" class="login-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å..." style="margin-bottom:10px; font-size:13px;"><div style="max-height:250px; overflow-y:auto; padding-right:5px;">${userListHTML}</div></div>
                
                <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd; color:var(--danger);">Zone ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</h4>
                <div style="display:flex; gap:10px;"><button onclick="resetChat('global')" class="btn-buy" style="background:var(--danger); flex:1;">‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó‡∏£‡∏ß‡∏°</button><button onclick="resetChat('private')" class="btn-buy" style="background:#6c757d; flex:1;">‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</button></div>
            ` : '';

            Swal.fire({ title: 'ADMIN PANEL', html: `<div style="max-height: 500px; overflow-y: auto; background:#f4f4f4; padding:15px; border-radius:10px; text-align:left;"><h4 style="margin:0 0 10px 0; border-bottom:1px solid #ddd;">‡πÅ‡∏ä‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h4>${chatUsers}${modManagerHtml}<h4 style="margin:15px 0 10px 0; border-bottom:1px solid #ddd;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</h4>${reqHtml}</div>`, confirmButtonText: '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á', showCancelButton: false });
        };

        window.addCoupon = function() { const code = document.getElementById('newCouponCode').value.trim(); const val = parseInt(document.getElementById('newCouponVal').value); if(!code || !val || val <= 0) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'warning'); state.coupons[code] = val; persist(); openAdminPanel(); };
        window.deleteCoupon = function(code) { delete state.coupons[code]; persist(); openAdminPanel(); };
        window.saveBotSettings = function() { const text = document.getElementById('botText').value; const interval = parseInt(document.getElementById('botInterval').value); const contentFileInput = document.getElementById('botFile'); const avatarFileInput = document.getElementById('botAvatarFile'); if(!text || interval < 5) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ', 'warning'); const readFile = (file) => new Promise((resolve) => { const reader = new FileReader(); reader.onload = (e) => resolve(e.target.result); reader.readAsDataURL(file); }); const processSave = async () => { let msgImgBase64 = state.botConfig.image; if (contentFileInput && contentFileInput.files && contentFileInput.files[0]) { msgImgBase64 = await readFile(contentFileInput.files[0]); } let avatarBase64 = state.botConfig.avatar; if (avatarFileInput && avatarFileInput.files && avatarFileInput.files[0]) { avatarBase64 = await readFile(avatarFileInput.files[0]); } state.botConfig.active = !state.botConfig.active; state.botConfig.text = text; state.botConfig.interval = interval; state.botConfig.image = msgImgBase64; state.botConfig.avatar = avatarBase64; state.botConfig.lastRun = Date.now(); persist(); openAdminPanel(); Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡∏ö‡∏≠‡∏ó ${state.botConfig.active ? '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô' : '‡∏´‡∏¢‡∏∏‡∏î'} ‡πÅ‡∏•‡πâ‡∏ß`, 'success'); }; processSave(); };
        window.deleteBotImage = function() { state.botConfig.image = null; persist(); openAdminPanel(); };
        window.resetBotAvatar = function() { state.botConfig.avatar = null; persist(); openAdminPanel(); };
        window.deletePrivateChat = function(targetUser) { Swal.fire({ title: '‡∏•‡∏ö‡πÅ‡∏ä‡∏ó?', text: `‡∏•‡∏ö‡πÅ‡∏ä‡∏ó‡∏Ç‡∏≠‡∏á ${targetUser}?`, icon: 'warning', showCancelButton: true, confirmButtonColor: '#dc3545', confirmButtonText: '‡∏•‡∏ö' }).then((res) => { if(res.isConfirmed) { delete state.privateMessages[targetUser]; if(state.chatMode === 'private' && state.activePrivateUser === targetUser) { state.activePrivateUser = null; document.getElementById('chatMessages').innerHTML = ''; } persist(); openAdminPanel(); Swal.fire('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'success'); } }); }
        window.resetChat = function(type) { if (!state.isAdmin) return; Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó?', text: '‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏∞', icon: 'warning', showCancelButton: true, confirmButtonColor: '#dc3545', confirmButtonText: '‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏¢' }).then((result) => { if (result.isConfirmed) { if (type === 'global') state.globalMessages = []; else state.privateMessages = {}; persist(); renderChat(); Swal.fire('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'success'); } }); };
        window.toggleModerator = function() { const target = document.getElementById('modTarget').value.trim(); if(!state.users[target]) return Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', '‡πÄ‡∏ä‡πá‡∏Ñ ID ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ', 'error'); if(target === 'Admin') return; const index = (state.moderators || []).indexOf(target); if(!state.moderators) state.moderators = []; if(index > -1) { state.moderators.splice(index, 1); Swal.fire('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', `‡∏ñ‡∏≠‡∏î ${target} ‡πÅ‡∏•‡πâ‡∏ß`, 'success'); } else { state.moderators.push(target); Swal.fire('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', `‡∏ï‡∏±‡πâ‡∏á ${target} ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏°`, 'success'); } persist(); openAdminPanel(); };
        window.adminSelectUser = function(username) { state.activePrivateUser = username; state.chatMode = 'private'; Swal.close(); if(!document.getElementById('chatBox').classList.contains('active')) toggleWebChat(); setChatMode('private'); };
        
        window.showPage = function(p) { document.getElementById('homePage').classList.toggle('hidden', p !== 'home'); document.getElementById('topupPage').classList.toggle('hidden', p !== 'topup'); window.scrollTo({top:0, behavior:'smooth'}); }
        window.toggleWebChat = function() { document.getElementById('chatBox').classList.toggle('active'); }
        window.setChatMode = function(mode) { state.chatMode = mode; if(document.getElementById('tabGlobal')) document.getElementById('tabGlobal').classList.toggle('active', mode === 'global'); if(document.getElementById('tabPrivate')) document.getElementById('tabPrivate').classList.toggle('active', mode === 'private'); if(document.getElementById('chatTitle')) document.getElementById('chatTitle').innerText = (mode === 'global') ? "Global Chat" : ((state.isAdmin || state.isModerator) ? "‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö: "+state.activePrivateUser : "‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô"); renderChat(); }
        window.handleChatImage = function(input) { if(!state.currentUser && !state.isAdmin) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô', 'warning'); if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = (e) => { const base64 = e.target.result; sendChat(null, base64); input.value = ''; }; reader.readAsDataURL(input.files[0]); } }
        window.viewImage = function(src) { Swal.fire({ imageUrl: src, showConfirmButton: false, background: 'transparent', backdrop: `rgba(0,0,0,0.8)` }); }
        
        window.renderChat = function() { const el = document.getElementById('chatMessages'); if(!el) return; el.innerHTML = ''; let msgs = []; if (state.chatMode === 'global') { msgs = state.globalMessages || []; } else { if(state.isAdmin || state.isModerator) { if(!state.activePrivateUser) { el.innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ä‡∏ó‡∏à‡∏≤‡∏Å Admin Panel</div>'; return; } msgs = (state.privateMessages && state.privateMessages[state.activePrivateUser]) ? state.privateMessages[state.activePrivateUser] : []; } else { msgs = (state.privateMessages && state.privateMessages[state.currentUser]) ? state.privateMessages[state.currentUser] : []; if(msgs.length === 0) el.innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">‡∏ó‡∏±‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö</div>'; } } msgs.forEach(m => { const isMe = (m.sender === state.currentUser) || (state.isAdmin && m.sender === 'Admin'); const isAdminMsg = m.sender === 'Admin' || (state.moderators && state.moderators.includes(m.sender)); const isBot = m.sender === 'Admin Bot'; let bubbleClass = 'msg-user'; if(isAdminMsg) bubbleClass = 'msg-admin'; if(isBot) bubbleClass = 'msg-bot'; let avatar = "https://cdn-icons-png.flaticon.com/512/149/149071.png"; if(m.sender === 'Admin') avatar = ADMIN_AVATAR_URL; else if(isBot) avatar = state.botConfig.avatar ? noCache(state.botConfig.avatar) : BOT_AVATAR_URL; else if(state.users[m.sender]) avatar = state.users[m.sender].avatar ? noCache(state.users[m.sender].avatar) : avatar; let senderName = m.sender; if(state.users[m.sender]) senderName = state.users[m.sender].nickname || state.users[m.sender].username; el.innerHTML += ` <div class="chat-row ${isMe ? 'right' : ''}"> ${!isMe ? `<img src="${avatar}" class="chat-avatar" onclick="showPublicProfile('${m.sender}')">` : ''} <div style="max-width:70%;"> ${!isMe ? `<span class="msg-sender">${senderName}</span>` : ''} <div class="msg ${bubbleClass}"> ${m.text ? `<div>${m.text}</div>` : ''} ${m.image ? `<img src="${m.image}" class="chat-img" onclick="viewImage('${m.image}')">` : ''} </div> </div> </div> `; }); el.scrollTop = el.scrollHeight; }
        window.sendChat = function(text = null, image = null) { if(!checkAuth()) return; if(!text) text = document.getElementById('chatInput').value.trim(); if(!text && !image) return; const msg = { sender: state.currentUser, text: text, image: image, time: Date.now() }; if(state.chatMode === 'global') { if(!state.globalMessages) state.globalMessages = []; state.globalMessages.push(msg); if(state.globalMessages.length > 50) state.globalMessages.shift(); } else { let target = state.currentUser; if(state.isAdmin || state.isModerator) target = state.activePrivateUser; if(!target) return Swal.fire('Error', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏π‡πà‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'error'); if(!state.privateMessages) state.privateMessages = {}; if(!state.privateMessages[target]) state.privateMessages[target] = []; state.privateMessages[target].push(msg); } document.getElementById('chatInput').value = ''; persist(); renderChat(); }
        window.initBotSystem = function() { setInterval(() => { if(!state.botConfig.active || !state.globalMessages) return; const now = Date.now(); const diff = (now - state.botConfig.lastRun) / 1000; if(diff >= state.botConfig.interval) { const botMsg = { sender: 'Admin Bot', text: state.botConfig.text, image: state.botConfig.image, time: now }; state.globalMessages.push(botMsg); if(state.globalMessages.length > 50) state.globalMessages.shift(); state.botConfig.lastRun = now; persist(); if(state.chatMode === 'global') renderChat(); } }, 1000); }
        
        const canvas = document.getElementById('snowCanvas'); const ctx = canvas.getContext('2d'); let width, height, flakes = []; function initSnow() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; flakes = Array.from({length: 80}, () => ({ x: Math.random() * width, y: Math.random() * height, r: Math.random() * 3 + 1, d: Math.random() * 1 + 0.5 })); } function drawSnow() { ctx.clearRect(0, 0, width, height); ctx.fillStyle = "rgba(255, 255, 255, 0.6)"; ctx.beginPath(); flakes.forEach(f => { ctx.moveTo(f.x, f.y); ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2); }); ctx.fill(); flakes.forEach(f => { f.y += f.d; if (f.y > height) f.y = -10; }); requestAnimationFrame(drawSnow); } window.addEventListener('resize', initSnow); initSnow(); drawSnow(); 
        
        updateUI(); 
        initBotSystem();
    </script>
    <script type="module">
    // 1. ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏°‡∏î‡∏π‡∏• Firebase ‡∏à‡∏≤‡∏Å CDN (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    // 2. ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏°‡πà‡∏≠‡∏ô‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡πä‡∏≠‡∏õ‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö)
    const firebaseConfig = {
      apiKey: "AIzaSyBORnXLQdZnETh9AMFMUx50FlLylKCVc2w",
      authDomain: "web-rental-system-d8894.firebaseapp.com",
      projectId: "web-rental-system-d8894",
      storageBucket: "web-rental-system-d8894.firebasestorage.app",
      messagingSenderId: "389385259939",
      appId: "1:389385259939:web:5a8de35f4a06b906e66816"
    };

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 3. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ shop001 ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
    const CURRENT_SHOP_ID = "shop001"; 

    // 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    async function checkShopStatus() {
        try {
            const shopRef = doc(db, "shops", CURRENT_SHOP_ID);
            const shopSnap = await getDoc(shopRef);

            if (shopSnap.exists()) {
                const shopData = shopSnap.data();
                
                // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 'active' (‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô 'suspended')
                if (shopData.status !== "active") {
                    // ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ "‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö" ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    document.body.innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #1a1a1a; color: white; font-family: 'Kanit', sans-serif; margin: 0; text-align: center;">
                            <div style="padding: 20px; border: 2px solid #ff4d4d; border-radius: 15px; background: #2d2d2d; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                                <h1 style="font-size: 50px; margin-bottom: 10px;">‚ö†Ô∏è</h1>
                                <h2 style="color: #ff4d4d; margin-bottom: 15px;">‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                                <p style="font-size: 18px; color: #ccc;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏</p>
                                <hr style="border: 0; border-top: 1px solid #444; margin: 20px 0;">
                                <p style="font-size: 14px; color: #888;">‡∏£‡∏´‡∏±‡∏™‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ${CURRENT_SHOP_ID}</p>
                            </div>
                        </div>
                    `;
                    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                    document.body.style.overflow = "hidden";
                }
            }
        } catch (error) {
            console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:", error);
        }
    }

    // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î
    checkShopStatus();
</script>

</body>
</html>
